// Digital Krishi Officer - Main JavaScript Application with Enhanced AI

// Translation data

const translations = {

siteTitle: {

ml: "ഫാംസേതു",

hi: "फार्मसेतु",

en: "FarmSetu"

},

tagline: {

ml: "24/7 കൃഷി സഹായം - എല്ലായ്പ്പോഴും ലഭ്യം, എല്ലായ്പ്പോഴും പഠിക്കുന്നു",

hi: "24/7 कृषि सहायता - हमेशा उपलब्ध, हमेशा सीखते रहना",

en: "24/7 aAgricultural Support - Always Available, Always Learning"

},

heroTitle: {

ml: "ഫാംസേതു",

hi: "फार्मसेतु",

en: "FarmSetu"

},

heroSubtitle: {

ml: "വ്യക്തിഗത കാർഷിക നിർദ്ദേശങ്ങൾ നൽകുന്ന നിങ്ങളുടെ 24/7 AI-പവർഡ് കാർഷിക ഉപദേഷ്ടാവ്",

hi: "आपका 24/7 एआई-संचालित कृषि सलाहकार जो व्यक्तिगत कृषि मार्गदर्शन प्रदान करता है",

en: "Your 24/7 AI-powered agricultural advisor providing personalized farming guidance"

},

askQuestion: {

ml: "ചോദ്യം ചോദിക്കുക",

hi: "प्रश्न पूछें",

en: "Ask a Question"

},

navHome: {

ml: "ഹോം",

hi: "होम",

en: "Home"

},

navAsk: {

ml: "ചോദ്യം ചോദിക്കുക",

hi: "प्रश्न पूछें",

en: "Ask a Question"

},

navHow: {

ml: "ഇത് എങ്ങനെ പ്രവർത്തിക്കുന്നു",

hi: "यह कैसे काम करता है",

en: "How It Works"

},

navResources: {

ml: "വിഭവങ്ങൾ",

hi: "संसाधन",

en: "Resources"

},

navDashboard: {

ml: "ഡാഷ്ബോർഡ്",

hi: "डैशबोर्ड",

en: "Dashboard"

},

navSuccess: {

ml: "വിജയ കഥകൾ",

hi: "सफलता की कहानियां",

en: "Success Stories"

},

statUsers: {

ml: "സജീവ ഉപയോക്താക്കൾ",

hi: "सक्रिय उपयोगकर्ता",

en: "Paddy"

},

statQueries: {

ml: "പരിഹരിച്ച ചോദ്യങ്ങൾ",

hi: "हल किए गए प्रश्न",

en: "Ginger"

},

statExperts: {

ml: "വിദഗ്ധ കൺസൾട്ടേഷനുകൾ",

hi: "विशेषज्ञ परामर्श",

en: "Tea"

},

statSchemes: {

ml: "സർക്കാർ പദ്ധതികൾ",

hi: "",

en: "Cardmom"

},

featuresTitle: {

ml: "പെട്ടെന്നുള്ള ആക്സസ്",

hi: "त्वरित पहुंच",

en: "Quick Access"

},

featureAsk: {

ml: "ചോദ്യങ്ങൾ ചോദിക്കുക",

hi: "प्रश्न पूछें",

en: "Ask Questions"

},

featureAskDesc: {

ml: "ടെക്സ്റ്റ്, ശബ്ദം, അല്ലെങ്കിൽ ഇമേജ് ഇൻപുട്ട്",

hi: "पाठ, आवाज या छवि इनपुट",

en: "Text, voice, or image input"

},

featureWeather: {

ml: "കാലാവസ്ഥാ അലർട്ടുകൾ",

hi: "मौसम अलर्ट",

en: "Weather Alerts"

},

featureWeatherDesc: {

ml: "തത്സമയ കാലാവസ്ഥാ അപ്ഡേറ്റുകൾ",

hi: "वास्तविक समय मौसम अपडेट",

en: "Real-time weather updates"

},

featurePrice: {

ml: "മാർക്കറ്റ് വിലകൾ",

hi: "बाजार मूल्य",

en: "Market Prices"

},

featurePriceDesc: {

ml: "നിലവിലെ മാർക്കറ്റ് റേറ്റുകൾ",

hi: "वर्तमान बाजार दरें",

en: "Current market rates"

},

featureExpert: {

ml: "വിദഗ്ധ സഹായം",

hi: "विशेषज्ञ सहायता",

en: "Expert Support"

},

featureExpertDesc: {

ml: "കാർഷിക വിദഗ്ധരുമായി ബന്ധപ്പെടുക",

hi: "कृषि विशेषज्ञों से जुड़ें",

en: "Connect with agricultural experts"

},

askTitle: {

ml: "നിങ്ങളുടെ കാർഷിക ചോദ്യം ചോദിക്കുക",

hi: "अपना कृषि प्रश्न पूछें",

en: "Ask Your Agricultural Question"

},

askSubtitle: {

ml: "ചോദ്യങ്ങൾ ചോദിക്കാൻ നിങ്ങളുടെ ഇഷ്ട രീതി തിരഞ്ഞെടുക്കുക",

hi: "प्रश्न पूछने के लिए अपनी पसंदीदा विधि चुनें",

en: "Choose your preferred method to ask questions"

},

tabText: {

ml: "ടെക്സ്റ്റ്",

hi: "पाठ",

en: "Text"

},

tabVoice: {

ml: "ശബ്ദം",

hi: "आवाज",

en: "Voice"

},

tabImage: {

ml: "ചിത്രം",

hi: "छवि",

en: "Image"

},

labelCrop: {

ml: "വിള തിരഞ്ഞെടുക്കുക",

hi: "फसल चुनें",

en: "Select Crop"

},

labelStage: {

ml: "കാർഷിക ഘട്ടം",

hi: "कृषि चरण",

en: "Farming Stage"

},

labelLocation: {

ml: "സ്ഥലം",

hi: "स्थान",

en: "Location"

},

recordText: {

ml: "റെക്കോർഡ് ചെയ്യാൻ ക്ലിക്ക് ചെയ്യുക",

hi: "रिकॉर्ड करने के लिए क्लिक करें",

en: "Click to Record"

},

uploadText: {

ml: "ചിത്രം ഇവിടെ ക്ലിക്ക് ചെയ്യുക അല്ലെങ്കിൽ ഡ്രാഗ് ചെയ്യുക",

hi: "छवि को यहां क्लिक करें या खींचें",

en: "Click or drag image here"

},

uploadHint: {

ml: "പിന്തുണ: JPG, PNG, JPEG",

hi: "समर्थन: JPG, PNG, JPEG",

en: "Support: JPG, PNG, JPEG"

},

autoLocationText: {

ml: "ഓട്ടോ-ഡിറ്റക്റ്റ്",

hi: "ऑटो-डिटेक्ट",

en: "Auto-detect"

},

examplesTitle: {

ml: "ഉദാഹരണ ചോദ്യങ്ങൾ:",

hi: "उदाहरण प्रश्न:",

en: "Example Questions:"

},

howTitle: {

ml: "ഇത് എങ്ങനെ പ്രവർത്തിക്കുന്നു",

hi: "यह कैसे काम करता है",

en: "How It Works"

},

resourcesTitle: {

ml: "വിഭവങ്ങളും വിവരങ്ങളും",

hi: "संसाधन और जानकारी",

en: "Resources & Information"

},

dashboardTitle: {

ml: "നിങ്ങളുടെ ഡാഷ്ബോർഡ്",

hi: "आपका डैशबोर्ड",

en: "Your Dashboard"

},

successTitle: {

ml: "വിജയ കഥകൾ",

hi: "सफलता की कहानियां",

en: "Success Stories"

},

schemesTitle: {

ml: "സർക്കാർ പദ്ധതികൾ",

hi: "सरकारी योजनाएं",

en: "Government Schemes"

},

weatherTitle: {

ml: "കാലാവസ്ഥാ വിവരങ്ങൾ",

hi: "मौसम की जानकारी",

en: "Weather Information"

},

marketTitle: {

ml: "മാർക്കറ്റ് വിലകൾ",

hi: "बाजार मूल्य",

en: "Market Prices"

},

libraryTitle: {

ml: "കീടങ്ങളും രോഗങ്ങളും ലൈബ്രറി",

hi: "कीट और रोग पुस्तकालय",

en: "Pest & Disease Library"

},

step1Title: {

ml: "നിങ്ങളുടെ ചോദ്യം ചോദിക്കുക",

hi: "अपना प्रश्न पूछें",

en: "Ask Your Question"

},

step2Title: {

ml: "AI-പവർഡ് ഉപദേശം നേടുക",

hi: "एआई-संचालित सलाह प्राप्त करें",

en: "Get AI-Powered Advice"

},

step3Title: {

ml: "പ്രവർത്തന ഘട്ടങ്ങൾ പാലിക്കുക",

hi: "कार्य चरणों का पालन करें",

en: "Follow Action Steps"

},

step4Title: {

ml: "വിദഗ്ധ വർദ്ധനവ്",

hi: "विशेषज्ञ वृद्धि",

en: "Expert Escalation"

},

navLogin: {

en: "Login",

hi: "लॉगिन",

ml: "ലോഗിൻ"

},

navSignUp: {

en: "SignUp",

hi: "साइन अप",

ml: "സൈൻ അപ്പ്"

},

navContactUs: {

en: "Contact Us",

hi: "संपर्क करें",

ml: "ബന്ധപ്പെടുക"

},

loginTitle: {

en: "Login",

hi: "लॉगिन",

ml: "ലോഗിൻ"

},

loginDesc: {

en: "Welcome back! Secure login with OTP verification.",

hi: "फिर से स्वागत है! ओटीपी सत्यापन के साथ सुरक्षित लॉगिन।",

ml: "വീണ്ടും സ്വാഗതം! OTP സ്ഥിരീകരണത്തോടെ സുരക്ഷിത ലോഗിൻ."

},

loginMobileLabel: {

en: "Mobile Number",

hi: "मोबाइल नंबर",

ml: "മൊബൈൽ നമ്പർ"

},

loginOtpLabel: {

en: "Enter OTP",

hi: "ओटीपी दर्ज करें",

ml: "OTP നൽകുക"

},

loginBtn: {

en: "Login",

hi: "लॉगिन",

ml: "ലോഗിൻ"

},

loginSendOtp: {

en: "Send OTP",

hi: "ओटीपी भेजें",

ml: "OTP അയയ്ക്കുക"

},

loginFooter: {

en: "Don't have an account?",

hi: "खाता नहीं है?",

ml: "അക്കൗണ്ട് ഇല്ലേ?"

},

loginSignUpLink: {

en: "Sign Up",

hi: "साइन अप",

ml: "സൈൻ അപ്പ്"

},

signupTitle: {

en: "Sign Up",

hi: "साइन अप",

ml: "സൈൻ അപ്പ്"

},

signupDesc: {

en: "Create your account for personalized farming support.",

hi: "व्यक्तिगत कृषि सहायता के लिए अपना खाता बनाएं।",

ml: "വ്യക്തിഗത കാർഷിക സഹായത്തിനായി നിങ്ങളുടെ അക്കൗണ്ട് സൃഷ്ടിക്കുക."

},

signupNameLabel: {

en: "Name",

hi: "नाम",

ml: "പേര്"

},

signupMobileLabel: {

en: "Mobile Number",

hi: "मोबाइल नंबर",

ml: "മൊബൈൽ നമ്പർ"

},

signupOtpLabel: {

en: "Enter OTP",

hi: "ओटीपी दर्ज करें",

ml: "OTP നൽകുക"

},

signupEmailLabel: {

en: "Email (optional)",

hi: "ईमेल (वैकल्पिक)",

ml: "ഇമെയിൽ (ഐച്ഛികം)"

},

signupBtn: {

en: "Sign Up",

hi: "साइन अप",

ml: "സൈൻ അപ്പ്"

},

signupFooter: {

en: "Already have an account?",

hi: "पहले से खाता है?",

ml: "ഇതിനകം അക്കൗണ്ട് ഉണ്ട്?"

},

signupLoginLink: {

en: "Login",

hi: "लॉगिन",

ml: "ലോഗിൻ"

},

contactTitle: {

en: "Contact Us",

hi: "संपर्क करें",

ml: "ബന്ധപ്പെടുക"

},

contactDesc: {

en: "Reach Kerala Agriculture Department via your preferred method.",

hi: "अपनी पसंदीदा विधि से केरल कृषि विभाग से संपर्क करें।",

ml: "നിങ്ങളുടെ ഇഷ്ടമായ രീതിയിൽ കേരള കാർഷിക വകുപ്പ് ബന്ധപ്പെടുക."

},

contactViaEmail: {

en: "Contact via Email",

hi: "ईमेल द्वारा संपर्क करें",

ml: "ഇമെയിൽ വഴി ബന്ധപ്പെടുക"

},

contactViaMobile: {

en: "Contact via Mobile",

hi: "मोबाइल द्वारा संपर्क करें",

ml: "മൊബൈൽ വഴി ബന്ധപ്പെടുക"

},

contactNameLabel: {

en: "Your Name",

hi: "आपका नाम",

ml: "നിങ്ങളുടെ പേര്"

},

contactMobileLabel: {

en: "Your Mobile Number",

hi: "आपका मोबाइल नंबर",

ml: "നിങ്ങളുടെ മൊബൈൽ നമ്പർ"

},

contactMessageLabel: {

en: "Message",

hi: "संदेश",

ml: "സന്ദേശം"

},

contactSendEmail: {

en: "Send Email",

hi: "ईमेल भेजें",

ml: "ഇമെയിൽ അയയ്ക്കുക"

},

contactEmailInfo: {

en: "Email will be sent to: krishibhavan@kerala.gov.in",

hi: "ईमेल भेजा जाएगा: krishibhavan@kerala.gov.in",

ml: "ഇമെയിൽ അയയ്ക്കപ്പെടും: krishibhavan@kerala.gov.in"

},

contactMobileInfo: {

en: "You can contact Kerala Agriculture Department at:",

hi: "आप केरल कृषि विभाग से संपर्क कर सकते हैं:",

ml: "നിങ്ങൾക്ക് കേരള കാർഷിക വകുപ്പ് ബന്ധപ്പെടാം:"

},

contactMobileNumber: {

en: "Phone:",

hi: "फोन:",

ml: "ഫോൺ:"



}
};

const schemesData = {

en: [

{

title: "PM Kisan Samman Nidhi",

desc: "₹6,000/year direct benefit transfer",

url: "https://pmkisan.gov.in/"

},

{

title: "Kisan Credit Card",

desc: "Up to ₹3 Lakh credit facility",

url: "https://kisancreditcard.gov.in/"

},

{

title: "Pradhan Mantri Fasal Bima Yojana (PMFBY)",

desc: "Crop insurance for farmers",

url: "https://www.keralaagriculture.gov.in/en/pmfby/"

},

{

title: "Soil Health Card Scheme",

desc: "Soil testing and recommendations",

url: "https://www.keralaagriculture.gov.in/en/soil-health-card/"

},

{

title: "Karshaka Kavalkaran",

desc: "Insurance for farmers in Kerala",

url: "https://www.keralaagriculture.gov.in/en/karshaka-kavalkaran/"

},

{

title: "Krishi Bhavan Services",

desc: "Local agricultural support and subsidies",

url: "https://www.keralaagriculture.gov.in/en/krishi-bhavan/"

},

{

title: "Vegetable Development Scheme",

desc: "Support for vegetable cultivation",

url: "https://www.keralaagriculture.gov.in/en/vegetable-development/"

},

{

title: "Organic Farming Promotion",

desc: "Subsidies and training for organic farming",

url: "https://www.keralaagriculture.gov.in/en/organic-farming/"

},

{

title: "Plantation Development Scheme",

desc: "Support for coconut, rubber, and other plantations",

url: "https://www.keralaagriculture.gov.in/en/plantation-development/"

},

{

title: "Karshaka Pension Scheme",

desc: "Pension for eligible farmers in Kerala",

url: "https://www.keralaagriculture.gov.in/en/karshaka-pension/"

}

],

hi: [

{

title: "पीएम किसान सम्मान निधि",

desc: "₹6,000/वर्ष प्रत्यक्ष लाभ अंतरण",

url: "https://pmkisan.gov.in/"

},

{

title: "किसान क्रेडिट कार्ड",

desc: "₹3 लाख तक की क्रेडिट सुविधा",

url: "https://kisancreditcard.gov.in/"

},

{

title: "प्रधान मंत्री फसल बीमा योजना (PMFBY)",

desc: "किसानों के लिए फसल बीमा",

url: "https://www.keralaagriculture.gov.in/en/pmfby/"

},

{

title: "मृदा स्वास्थ्य कार्ड योजना",

desc: "मृदा परीक्षण और सिफारिशें",

url: "https://www.keralaagriculture.gov.in/en/soil-health-card/"

},

{

title: "कृषक कवलकरण",

desc: "केरल के किसानों के लिए बीमा",

url: "https://www.keralaagriculture.gov.in/en/karshaka-kavalkaran/"

},

{

title: "कृषि भवन सेवाएँ",

desc: "स्थानीय कृषि सहायता और सब्सिडी",

url: "https://www.keralaagriculture.gov.in/en/krishi-bhavan/"

},

{

title: "सब्जी विकास योजना",

desc: "सब्जी खेती के लिए समर्थन",

url: "https://www.keralaagriculture.gov.in/en/vegetable-development/"

},

{

title: "जैविक खेती प्रोत्साहन",

desc: "जैविक खेती के लिए सब्सिडी और प्रशिक्षण",

url: "https://www.keralaagriculture.gov.in/en/organic-farming/"

},

{

title: "प्लांटेशन विकास योजना",

desc: "नारियल, रबर और अन्य प्लांटेशन के लिए समर्थन",

url: "https://www.keralaagriculture.gov.in/en/plantation-development/"

},

{

title: "कृषक पेंशन योजना",

desc: "केरल के पात्र किसानों के लिए पेंशन",

url: "https://www.keralaagriculture.gov.in/en/karshaka-pension/"

}

],

ml: [

{

title: "പി.എം. കിസാൻ സമ്മാൻ നിധി",

desc: "വർഷം ₹6,000 നേരിട്ട് ലഭ്യമാക്കൽ",

url: "https://pmkisan.gov.in/"

},

{

title: "കിസാൻ ക്രെഡിറ്റ് കാർഡ്",

desc: "₹3 ലക്ഷം വരെ ക്രെഡിറ്റ് സൗകര്യം",

url: "https://kisancreditcard.gov.in/"

},

{

title: "പ്രധാനമന്ത്രി ഫസൽ বীম യോജന (PMFBY)",

desc: "കർഷകർക്ക് വിള ഇൻഷുറൻസ്",

url: "https://www.keralaagriculture.gov.in/en/pmfby/"

},

{

title: "സോയിൽ ഹെൽത്ത് കാർഡ് പദ്ധതി",

desc: "മണ്ണ് പരിശോധനയും ശുപാർശകളും",

url: "https://www.keralaagriculture.gov.in/en/soil-health-card/"

},

{

title: "കർഷക കാവൽക്കാരൻ",

desc: "കേരളത്തിലെ കർഷകർക്ക് ഇൻഷുറൻസ്",

url: "https://www.keralaagriculture.gov.in/en/karshaka-kavalkaran/"

},

{

title: "കൃഷി ഭവൻ സേവനങ്ങൾ",

desc: "പ്രാദേശിക കാർഷിക സഹായവും സബ്സിഡിയും",

url: "https://www.keralaagriculture.gov.in/en/krishi-bhavan/"

},

{

title: "പച്ചക്കറി വികസന പദ്ധതി",

desc: "പച്ചക്കറി കൃഷിക്ക് പിന്തുണ",

url: "https://www.keralaagriculture.gov.in/en/vegetable-development/"

},

{

title: "ഓർഗാനിക് ഫാർമിംഗ് പ്രൊമോഷൻ",

desc: "ഓർഗാനിക് കൃഷിക്ക് സബ്സിഡിയും പരിശീലനവും",

url: "https://www.keralaagriculture.gov.in/en/organic-farming/"

},

{

title: "പ്ലാന്റേഷൻ വികസന പദ്ധതി",

desc: "തേങ്ങ, റബ്ബർ, മറ്റ് പ്ലാന്റേഷനുകൾക്ക് പിന്തുണ",

url: "https://www.keralaagriculture.gov.in/en/plantation-development/"

},

{

title: "കർഷക പെൻഷൻ പദ്ധതി",

desc: "കേരളത്തിലെ അർഹരായ കർഷകർക്ക് പെൻഷൻ",

url: "https://www.keralaagriculture.gov.in/en/karshaka-pension/"

}

]

};

// Crop data

const crops = {

ml: ["നെൽ", "കേള", "തേങ്ങ", "കുരുമുളക്", "ഏലത്തി", "കാപ്പി", "റബ്ബർ", "കശുവണ്ടി"],

hi: ["धान", "केला", "नारियल", "काली मिर्च", "इलायची", "कॉफी", "रबड़", "काजू"],

en: ["Rice", "Banana", "Coconut", "Black Pepper", "Cardamom", "Coffee", "Rubber", "Cashew"]

};

// Farming stages data

const farmingStages = {

ml: ["വിതയ്ക്കൽ", "വളർച്ച", "പുഷ്പിക്കൽ", "കായ്ക്കൽ", "വിളവെടുപ്പ്"],

hi: ["बुवाई", "विकास", "फूलना", "फल लगना", "कटाई"],

en: ["Sowing", "Growing", "Flowering", "Fruiting", "Harvesting"]

};

// Locations data

const locations = {

ml: ["തിരുവനന്തപുരം", "കൊച്ചി", "കോഴിക്കോട്", "തൃശ്ശൂർ", "കണ്ണൂർ"],

hi: ["तिरुवनंतपुरम", "कोच्चि", "कोझिकोड", "त्रिशूर", "कन्नूर"],

en: ["Thiruvananthapuram", "Kochi", "Kozhikode", "Thrissur", "Kannur"]

};

// ENHANCED AI RESPONSE SYSTEM - NEW ADDITION

// Agricultural Knowledge Base with multilingual responses
const aiKnowledgeBase = {
    diseases: {
        en: {
            rice_blast: "Rice Blast Disease: Apply Tricyclazole 75% WP @ 0.6g/L. Spray at tillering and booting stages. Use resistant varieties like Jyoti, Rohini. Avoid excessive nitrogen fertilization. Ensure proper field drainage and avoid water stagnation.",
            banana_leaf_spot: "Banana Leaf Spot: Apply copper-based fungicide like Bordeaux mixture @ 0.5%. Remove affected leaves immediately. Ensure proper drainage and avoid overhead irrigation. Spray every 15 days during humid conditions. Improve air circulation between plants.",
            coconut_root_wilt: "Coconut Root Wilt: Inject Aureofungin-Sol @ 2ml + water 1L into palm stem through root feeding. Apply organic manure regularly. Ensure proper drainage around palm base. Remove affected palms immediately to prevent spread.",
            tomato_blight: "Tomato Blight: Use Mancozeb 75% WP @ 2.5g/L. Spray weekly during humid conditions. Remove affected fruits and leaves immediately. Improve air circulation between plants. Avoid overhead watering.",
            pepper_disease: "Black Pepper Disease: Apply copper oxychloride @ 2g/L during rainy season. Ensure proper drainage in pepper gardens. Prune affected vines immediately. Use Trichoderma as bio-control agent @ 5g per plant."
        },
        hi: {
            rice_blast: "धान ब्लास्ट रोग: ट्राइसाइक्लाजोल 75% WP @ 0.6g/L का प्रयोग करें। टिलरिंग और बूटिंग अवस्था में छिड़काव करें। ज्योति, रोहिणी जैसी प्रतिरोधी किस्में उगाएं। अधिक नाइट्रोजन से बचें।",
            banana_leaf_spot: "केले की पत्ती धब्बा: बोर्डो मिश्रण @ 0.5% जैसे कॉपर फंगीसाइड का प्रयोग करें। प्रभावित पत्तियां तुरंत हटाएं। उचित जल निकासी सुनिश्चित करें। 15 दिन में छिड़काव करें।",
            coconut_root_wilt: "नारियल जड़ मुरझाना: तने में ऑरियोफंगिन-सोल @ 2ml + पानी 1L का इंजेक्शन लगाएं। नियमित रूप से जैविक खाद डालें। उचित जल निकासी करें।",
            tomato_blight: "टमाटर झुलसा: मैंकोजेब 75% WP @ 2.5g/L का प्रयोग करें। साप्ताहिक छिड़काव करें। प्रभावित फल और पत्तियां तुरंत हटाएं।",
            pepper_disease: "काली मिर्च रोग: बरसात के मौसम में कॉपर ऑक्सीक्लोराइड @ 2g/L का प्रयोग करें। उचित जल निकासी सुनिश्चित करें।"
        },
        ml: {
            rice_blast: "നെല്ലിന്റെ ബ്ലാസ്റ്റ് രോഗം: ട്രൈസൈക്ലാസോൾ 75% WP @ 0.6g/L ഉപയോഗിക്കുക. കുലപിരിവ്, കതിർവിടൽ ഘട്ടങ്ങളിൽ തളിക്കുക. ജ്യോതി, രോഹിണി പോലുള്ള പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ ഉപയോഗിക്കുക. അമിത നൈട്രജൻ ഒഴിവാക്കുക.",
            banana_leaf_spot: "വാഴയിലെ ഇലപ്പാട്: ബോർഡോ മിശ്രിതം @ 0.5% പോലുള്ള കോപ്പർ ഫംഗിസൈഡ് പ്രയോഗിക്കുക. രോഗബാധിത ഇലകൾ ഉടനെ നീക്കം ചെയ്യുക. ശരിയായ ജലനിർഗമനം ഉറപ്പാക്കുക.",
            coconut_root_wilt: "തെങ്ങിന്റെ വേരുവാടൽ: കാണ്ഡത്തിൽ ഓറിയോഫംഗിൻ-സോൾ @ 2ml + വെള്ളം 1L കുത്തിവയ്പ്പ് നൽകുക. പതിവായി ജൈവവളം പ്രയോഗിക്കുക.",
            tomato_blight: "തക്കാളി ഇലപ്പാട്: മാൻകോസെബ് 75% WP @ 2.5g/L ഉപയോഗിക്കുക. ആഴ്ചയിലൊരിക്കൽ തളിക്കുക. രോഗബാധിത ഫലങ്ങളും ഇലകളും ഉടനെ നീക്കം ചെയ്യുക.",
            pepper_disease: "കുരുമുളക് രോഗം: മഴക്കാലത്ത് കോപ്പർ ഓക്സിക്ലോറൈഡ് @ 2g/L ഉപയോഗിക്കുക. കുരുമുളക് തോട്ടങ്ങളിൽ ശരിയായ ജലനിർഗമനം ഉറപ്പാക്കുക."
        }
    },
    fertilizers: {
        en: {
            rice: "Rice Fertilizer Schedule: Basal dose - Apply N:P:K 20:10:10 kg/acre before final puddling. First top dressing (20-25 days after transplanting) - 25kg Urea/acre during tillering. Second top dressing (40-45 days) - 15kg Urea/acre at panicle initiation. Also apply 25kg DAP/acre during land preparation.",
            banana: "Banana Fertilizer Program: Apply 200g N + 60g P2O5 + 300g K2O per plant annually. Split into 6 equal doses every 2 months starting from 2nd month after planting. Also apply 10kg farmyard manure per plant every 6 months. Add lime if soil pH is below 6.0.",
            coconut: "Coconut Fertilizer Schedule: Apply 1.3kg fertilizer mixture per palm twice yearly (June & December). Annual composition per palm: Urea 1.3kg + Rock phosphate 2kg + Muriate of Potash 3.25kg + Lime 0.5kg. Apply in a circular trench 2 meters from palm base.",
            pepper: "Black Pepper Fertilizer: Apply NPK 40:20:80 g/vine/year in split doses. First application in May-June (pre-monsoon), second in September-October (post-monsoon). Add 10-15 kg organic manure per vine annually. Mulch heavily during dry periods.",
            vegetables: "Vegetable Fertilizer General: Apply N:P:K 120:60:60 kg/ha as basal dose before transplanting. Top dress with 60kg Nitrogen/ha at 30 and 60 days after transplanting. Add 25 tonnes organic manure/ha before land preparation."
        },
        hi: {
            rice: "धान उर्वरक कार्यक्रम: आधार खुराक - अंतिम जुताई से पहले N:P:K 20:10:10 किग्रा/एकड़ डालें। पहली टॉप ड्रेसिंग (रोपाई के 20-25 दिन बाद) - टिलरिंग के दौरान 25 किग्रा यूरिया/एकड़। दूसरी टॉप ड्रेसिंग (40-45 दिन) - बाली निकलने पर 15 किग्रा यूरिया/एकड़।",
            banana: "केला उर्वरक कार्यक्रम: प्रति पौधा वार्षिक 200g N + 60g P2O5 + 300g K2O डालें। रोपाई के 2 महीने बाद से शुरू करके हर 2 महीने में 6 बराबर भागों में बांटकर दें। हर 6 महीने में 10 किग्रा गोबर की खाद भी दें।",
            coconut: "नारियल उर्वरक अनुसूची: प्रति पेड़ 1.3 किग्रा उर्वरक मिश्रण वर्ष में दो बार (जून और दिसंबर) डालें। प्रति पेड़ वार्षिक संरचना: यूरिया 1.3 किग्रा + रॉक फॉस्फेट 2 किग्रा + मूरिएट ऑफ पोटाश 3.25 किग्रा।",
            pepper: "काली मिर्च उर्वरक: NPK 40:20:80 g/बेल/वर्ष विभाजित खुराक में डालें। पहला अनुप्रयोग मई-जून (मानसून पूर्व), दूसरा सितंबर-अक्टूबर (मानसून बाद) में।",
            vegetables: "सब्जी उर्वरक सामान्य: रोपाई से पहले N:P:K 120:60:60 किग्रा/हेक्टेयर आधार खुराक के रूप में डालें। रोपाई के 30 और 60 दिन बाद 60 किग्रा नाइट्रोजन/हेक्टेयर टॉप ड्रेस करें।"
        },
        ml: {
            rice: "നെൽ വള പ്രയോഗ പട്ടിക: അടിവള - അവസാന ഉഴുതു മറിക്കുന്നതിന് മുമ്പ് N:P:K 20:10:10 കിലോ/ഏക്കർ പ്രയോഗിക്കുക. ആദ്യ മേൽവള (നടീലിനു ശേഷം 20-25 ദിവസം) - കുലപിരിവ് സമയത്ത് 25 കിലോ യൂറിയ/ഏക്കർ. രണ്ടാം മേൽവള (40-45 ദിവസം) - കതിർവിടൽ ഘട്ടത്തിൽ 15 കിലോ യൂറിയ/ഏക്കർ.",
            banana: "വാഴ വള പദ്ധതി: ഒരു ചെടിക്ക് വാർഷികമായി 200g N + 60g P2O5 + 300g K2O പ്രയോഗിക്കുക. നടീലിനു ശേഷം 2-ാം മാസം മുതൽ ആരംഭിച്ച് രണ്ട് മാസത്തിലൊരിക്കൽ 6 തുല്യ ഭാഗങ്ങളായി വിഭജിച്ച് നൽകുക. ആറ് മാസത്തിലൊരിക്കൽ 10 കിലോ ഗോവളവും നൽകുക.",
            coconut: "തെങ്ങ് വള പട്ടിക: ഒരു മരത്തിന് 1.3 കിലോ വള മിശ്രിതം വർഷത്തിൽ രണ്ട് തവണ (ജൂൺ, ഡിസംബർ) പ്രയോഗിക്കുക. ഒരു മരത്തിന് വാർഷിക ഘടന: യൂറിയ 1.3 കിലോ + റോക്ക് ഫോസ്ഫേറ്റ് 2 കിലോ + മ്യൂറിയേറ്റ് ഓഫ് പൊട്ടാഷ് 3.25 കിലോ.",
            pepper: "കുരുമുളക് വളം: NPK 40:20:80 g/വള്ളി/വർഷം വിഭജിച്ച് പ്രയോഗിക്കുക. ആദ്യ പ്രയോഗം മെയ്-ജൂണിൽ (മഴക്കാലത്തിന് മുമ്പ്), രണ്ടാമത് സെപ്തംബർ-ഒക്ടോബറിൽ (മഴക്കാലത്തിന് ശേഷം).",
            vegetables: "പച്ചക്കറി വളം പൊതുവേ: നടീലിനു മുമ്പ് N:P:K 120:60:60 കിലോ/ഹെക്ടർ അടിവളമായി പ്രയോഗിക്കുക. നടീലിനു ശേഷം 30, 60 ദിവസങ്ങളിൽ 60 കിലോ നൈട്രജൻ/ഹെക്ടർ മേൽവളം."
        }
    },
    general: {
        en: {
            weather: "Current weather in Kerala: Partly cloudy with temperatures ranging 24-32°C. Southwest winds 10-15 km/h. Good conditions for most farming activities. Evening watering recommended for vegetable crops. Avoid pesticide application during windy conditions.",
            market_prices: "Current market prices in Kerala (approximate): Rice ₹30-35/kg, Coconut ₹25-30/piece, Banana ₹40-50/dozen, Black pepper ₹450-500/kg, Cardamom ₹1200-1500/kg, Ginger ₹80-120/kg. Prices vary by district and quality grade.",
            soil_management: "Soil Health Management: Get soil tested every 2-3 years through local Krishi Bhavan. Maintain pH 6.0-7.0 for most crops. Add organic matter minimum 2-3% annually. Practice green manuring with cowpea, sunhemp during fallow periods.",
            organic_farming: "Organic Farming Guidelines: Use compost, vermicompost, neem cake, bone meal as primary nutrients. Practice crop rotation and companion planting. Implement Integrated Pest Management using bio-agents. Certification available through APEDA for premium marketing.",
            water_management: "Water Management: Practice drip irrigation to save 40-60% water. Use mulching to reduce evaporation. Harvest rainwater during monsoon. Avoid waterlogging in paddy fields after grain filling stage."
        },
        hi: {
            weather: "केरल में वर्तमान मौसम: आंशिक बादल के साथ तापमान 24-32°C। दक्षिण-पश्चिम हवा 10-15 किमी/घंटा। अधिकांश खेती के काम के लिए अच्छी स्थिति। सब्जी फसलों के लिए शाम को पानी देने की सिफारिश।",
            market_prices: "केरल में वर्तमान बाजार मूल्य (लगभग): चावल ₹30-35/किग्रा, नारियल ₹25-30/पीस, केला ₹40-50/दर्जन, काली मिर्च ₹450-500/किग्रा, इलायची ₹1200-1500/किग्रा।",
            soil_management: "मिट्टी स्वास्थ्य प्रबंधन: स्थानीय कृषि भवन के माध्यम से हर 2-3 साल में मिट्टी की जांच कराएं। अधिकांश फसलों के लिए pH 6.0-7.0 बनाए रखें। वार्षिक न्यूनतम 2-3% जैविक पदार्थ मिलाएं।",
            organic_farming: "जैविक खेती दिशानिर्देश: प्राथमिक पोषक तत्वों के रूप में कंपोस्ट, केंचुआ खाद, नीम खली, हड्डी का चूरा का उपयोग करें। फसल चक्र और साथी रोपण का अभ्यास करें।",
            water_management: "जल प्रबंधन: 40-60% पानी बचाने के लिए ड्रिप सिंचाई का अभ्यास करें। वाष्पीकरण कम करने के लिए मल्चिंग का उपयोग करें। मानसून के दौरान वर्षा जल संचयन करें।"
        },
        ml: {
            weather: "കേരളത്തിൽ നിലവിലെ കാലാവസ്ഥ: ഭാഗികമായി മേഘാച്ഛന്നം, താപനില 24-32°C. തെക്കുപടിഞ്ഞാറൻ കാറ്റ് 10-15 കിലോമീറ്റർ/മണിക്കൂർ. മിക്ക കൃഷിപ്പണികൾക്കും നല്ല അവസ്ഥ. പച്ചക്കറി വിളകൾക്ക് വൈകുന്നേരം വെള്ളം നൽകുക.",
            market_prices: "കേരളത്തിലെ നിലവിലെ വിപണി വില (ഏകദേശം): അരി ₹30-35/കിലോ, തെങ്ങ് ₹25-30/എണ്ണം, വാഴപ്പഴം ₹40-50/ഡസൻ, കുരുമുളക് ₹450-500/കിലോ, ഏലം ₹1200-1500/കിലോ.",
            soil_management: "മണ്ണിന്റെ ആരോഗ്യ പരിപാലനം: പ്രാദേശിക കൃഷി ഭവൻ വഴി 2-3 വർഷത്തിലൊരിക്കൽ മണ്ണ് പരിശോധന നടത്തുക. മിക്ക വിളകൾക്കും pH 6.0-7.0 നിലനിർത്തുക. വാർഷികമായി കുറഞ്ഞത് 2-3% ജൈവപദാർത്ഥം ചേർക്കുക.",
            organic_farming: "ജൈവകൃഷി മാർഗനിർദേശങ്ങൾ: പ്രാഥമിക പോഷകങ്ങളായി കമ്പോസ്റ്റ്, പുഴു വളം, വേപ്പിൻ പിണ്ണാക്ക്, അസ്ഥി പൊടി ഉപയോഗിക്കുക. വിളക്രമവും സഹകൃഷിയും പരിശീലിക്കുക.",
            water_management: "ജല പരിപാലനം: 40-60% വെള്ളം ലാഭിക്കാൻ ഡ്രിപ് സേചനം പരിശീലിക്കുക. ബാഷ്പീകരണം കുറയ്ക്കാൻ മൾച്ചിംഗ് ഉപയോഗിക്കുക. മഴക്കാലത്ത് മഴവെള്ള സംഭരണം നടത്തുക."
        }
    }
};

// Keywords for intelligent matching (multilingual)
const aiKeywords = {
    disease: {
        en: ['disease', 'sick', 'problem', 'leaf', 'spot', 'yellow', 'brown', 'pest', 'insect', 'bug', 'wilt', 'rot', 'infection', 'fungus', 'virus', 'bacteria', 'dying', 'damage'],
        hi: ['रोग', 'बीमारी', 'समस्या', 'पत्ती', 'धब्बा', 'पीला', 'भूरा', 'कीड़ा', 'संक्रमण', 'सड़न', 'फंगस', 'वायरस', 'बैक्टीरिया', 'मर', 'नुकसान'],
        ml: ['രോഗം', 'അസുഖം', 'പ്രശ്നം', 'ഇല', 'പാട്', 'മഞ്ഞ', 'തവിട്ട്', 'കീട', 'പുഴു', 'അണുബാധ', 'ചവറ്', 'ഫംഗസ്', 'വൈറസ്', 'ബാക്ടീരിയ', 'മരിക്കുന്നു', 'നാശം']
    },
    fertilizer: {
        en: ['fertilizer', 'nutrient', 'feed', 'manure', 'compost', 'npk', 'urea', 'phosphate', 'potash', 'nitrogen', 'phosphorus', 'potassium', 'organic', 'growth', 'yield'],
        hi: ['उर्वरक', 'खाद', 'पोषक', 'गोबर', 'यूरिया', 'फास्फोरस', 'पोटाश', 'जैविक', 'नाइट्रोजन', 'फास्फोरस', 'पोटैशियम', 'विकास', 'उत्पादन'],
        ml: ['വളം', 'പോഷകം', 'ഗോവളം', 'യൂറിയ', 'ഫോസ്ഫേറ്റ്', 'പൊട്ടാഷ്', 'ജൈവവളം', 'നൈട്രജൻ', 'ഫോസ്ഫറസ്', 'പൊട്ടാസ്യം', 'വളർച്ച', 'വിളവ്']
    },
    weather: {
        en: ['weather', 'rain', 'temperature', 'wind', 'humidity', 'forecast', 'climate', 'sunny', 'cloudy', 'hot', 'cold', 'season'],
        hi: ['मौसम', 'बारिश', 'तापमान', 'हवा', 'नमी', 'जलवायु', 'धूप', 'बादल', 'गर्म', 'ठंड', 'मौसम'],
        ml: ['കാലാവസ്ഥ', 'മഴ', 'താപനില', 'കാറ്റ്', 'ആർദ്രത', 'കാലാവസ്ഥാ പ്രവചനം', 'വെയിൽ', 'മേഘം', 'ചൂട്', 'തണുപ്പ്', 'സീസൺ']
    },
    market: {
        en: ['price', 'cost', 'market', 'rate', 'sell', 'buy', 'value', 'money', 'profit', 'income', 'rupees'],
        hi: ['दाम', 'कीमत', 'बाजार', 'दर', 'बेचना', 'खरीदना', 'मूल्य', 'पैसा', 'लाभ', 'आय', 'रुपये'],
        ml: ['വില', 'നിരക്ക്', 'മാർക്കറ്റ്', 'വിലയിരുത്തൽ', 'വിൽക്കുക', 'വാങ്ങുക', 'മൂല്യം', 'പൈസ', 'ലാഭം', 'വരുമാനം', 'രൂപ']
    },
    crops: {
        rice: {
            en: ['rice', 'paddy', 'grain', 'nellu'],
            hi: ['धान', 'चावल', 'अनाज'],
            ml: ['നെൽ', 'അരി', 'ധാന്യം', 'നെല്ലു']
        },
        banana: {
            en: ['banana', 'plantain'],
            hi: ['केला', 'कच्चा केला'],
            ml: ['വാഴ', 'എത്തക്കാ', 'വാഴപ്പഴം']
        },
        coconut: {
            en: ['coconut', 'palm'],
            hi: ['नारियल', 'ताड़'],
            ml: ['തെങ്ങ്', 'കോപ്ര', 'നാളികേരം']
        },
        pepper: {
            en: ['pepper', 'spice', 'black pepper'],
            hi: ['मिर्च', 'काली मिर्च', 'मसाला'],
            ml: ['കുരുമുളക്', 'മസാല']
        }
    }
};

// AI Response Generation Function
function generateAIResponse(question, crop, stage, location) {
    const lang = currentLanguage;
    const lowerQuestion = question.toLowerCase();
    
    // Determine crop type from question or dropdown
    let cropType = 'general';
    for (const [key, value] of Object.entries(aiKeywords.crops)) {
        if (value[lang] && value[lang].some(keyword => lowerQuestion.includes(keyword.toLowerCase()))) {
            cropType = key;
            break;
        }
    }
    
    // If crop is selected in dropdown, use that
    if (crop && crop !== '') {
        const cropIndex = crops[lang].indexOf(crop);
        if (cropIndex >= 0) {
            const cropKeys = Object.keys(aiKeywords.crops);
            if (cropIndex < cropKeys.length) {
                cropType = cropKeys[cropIndex];
            }
        }
    }
    
    // Check for disease-related queries
    if (aiKeywords.disease[lang].some(keyword => lowerQuestion.includes(keyword))) {
        if (cropType === 'rice') return aiKnowledgeBase.diseases[lang].rice_blast;
        if (cropType === 'banana') return aiKnowledgeBase.diseases[lang].banana_leaf_spot;
        if (cropType === 'coconut') return aiKnowledgeBase.diseases[lang].coconut_root_wilt;
        if (cropType === 'pepper') return aiKnowledgeBase.diseases[lang].pepper_disease;
        return aiKnowledgeBase.diseases[lang].tomato_blight; // Default disease response
    }
    
    // Check for fertilizer-related queries
    if (aiKeywords.fertilizer[lang].some(keyword => lowerQuestion.includes(keyword))) {
        if (cropType === 'rice') return aiKnowledgeBase.fertilizers[lang].rice;
        if (cropType === 'banana') return aiKnowledgeBase.fertilizers[lang].banana;
        if (cropType === 'coconut') return aiKnowledgeBase.fertilizers[lang].coconut;
        if (cropType === 'pepper') return aiKnowledgeBase.fertilizers[lang].pepper;
        return aiKnowledgeBase.fertilizers[lang].vegetables; // Default fertilizer response
    }
    
    // Check for weather-related queries
    if (aiKeywords.weather[lang].some(keyword => lowerQuestion.includes(keyword))) {
        return aiKnowledgeBase.general[lang].weather;
    }
    
    // Check for market price queries
    if (aiKeywords.market[lang].some(keyword => lowerQuestion.includes(keyword))) {
        return aiKnowledgeBase.general[lang].market_prices;
    }
    
    // Check for soil management queries
    if (lowerQuestion.includes('soil') || lowerQuestion.includes('मिट्टी') || lowerQuestion.includes('മണ്ണ്')) {
        return aiKnowledgeBase.general[lang].soil_management;
    }
    
    // Check for organic farming queries
    if (lowerQuestion.includes('organic') || lowerQuestion.includes('जैविक') || lowerQuestion.includes('ജൈവ')) {
        return aiKnowledgeBase.general[lang].organic_farming;
    }
    
    // Check for water management queries
    if (lowerQuestion.includes('water') || lowerQuestion.includes('irrigation') || lowerQuestion.includes('पानी') || lowerQuestion.includes('सिंचाई') || lowerQuestion.includes('വെള്ളം') || lowerQuestion.includes('സേചനം')) {
        return aiKnowledgeBase.general[lang].water_management;
    }
    
    // Default intelligent response based on language
    const defaultResponses = {
        en: `Thank you for your agricultural question about ${crop || 'farming'}${stage ? ` during ${stage} stage` : ''}${location ? ` in ${location}` : ' in Kerala'}. Based on your query, I recommend consulting with your local Krishi Bhavan officer for personalized field-specific advice. For immediate expert assistance, you can contact our agricultural helpline at 1800-180-1551. You may also visit your nearest agricultural extension office for hands-on guidance.`,
        hi: `${crop || 'खेती'} के बारे में आपके कृषि प्रश्न के लिए धन्यवाद${stage ? ` ${stage} की अवस्था में` : ''}${location ? ` ${location} में` : ' केरल में'}। आपके प्रश्न के आधार पर, मैं व्यक्तिगत खेत-विशिष्ट सलाह के लिए अपने स्थानीय कृषि भवन अधिकारी से परामर्श करने की सिफारिश करता हूं। तत्काल विशेषज्ञ सहायता के लिए आप हमारी कृषि हेल्पलाइन 1800-180-1551 पर संपर्क कर सकते हैं।`,
        ml: `${crop || 'കൃഷി'}യെക്കുറിച്ചുള്ള നിങ്ങളുടെ കാർഷിക ചോദ്യത്തിന് നന്ദി${stage ? ` ${stage} ഘട്ടത്തിൽ` : ''}${location ? ` ${location}യിൽ` : ' കേരളത്തിൽ'}। നിങ്ങളുടെ ചോദ്യത്തിന്റെ അടിസ്ഥാനത്തിൽ, വ്യക്തിഗത ഫീൽഡ് നിർദ്ദിഷ്ട ഉപദേശത്തിനായി നിങ്ങളുടെ പ്രാദേശിക കൃഷി ഭവൻ ഓഫീസറുമായി കൂടിയാലോചിക്കാൻ ഞാൻ ശുപാർശ ചെയ്യുന്നു। ഉടനടി വിദഗ്ദ സഹായത്തിനായി ഞങ്ങളുടെ കാർഷിക ഹെൽപ്പ് ലൈൻ 1800-180-1551 ൽ ബന്ധപ്പെടാവുന്നതാണ്।`
    };
    
    return defaultResponses[lang];
}

// Global state

let currentLanguage = 'en';

let currentSection = 'home';

let isRecording = false;

let mediaRecorder = null;

let recordedChunks = [];

// DOM Content Loaded Event Listener

document.addEventListener('DOMContentLoaded', function() {

initializeApp();

});

// Initialize Application

function initializeApp() {

setupEventListeners();

updateLanguage(currentLanguage);

populateDropdowns();

showSection('home');

}

// Setup Event Listeners

function setupEventListeners() {

// Language switcher

document.querySelectorAll('.lang-btn').forEach(btn => {

btn.addEventListener('click', function() {

const lang = this.getAttribute('data-lang');

switchLanguage(lang);

});

});

// Navigation

document.querySelectorAll('.nav-link').forEach(link => {

link.addEventListener('click', function(e) {

e.preventDefault();

const section = this.getAttribute('href').substring(1);

showSection(section);

});

});

// Ask Question button in hero

document.getElementById('askQuestionBtn').addEventListener('click', function() {

showSection('ask-question');

});

// Quick Access Feature Cards - FIX: Add click event listeners

setupQuickAccessCards();

// Method tabs

document.querySelectorAll('.method-tab').forEach(tab => {

tab.addEventListener('click', function() {

const method = this.getAttribute('data-method');

switchInputMethod(method);

});

});

// Voice recording

document.getElementById('recordBtn').addEventListener('click', toggleRecording);

// Image upload - FIX: Ensure proper event listeners

setupImageUpload();

// Auto-location button

document.getElementById('autoLocationBtn').addEventListener('click', getAutoLocation);

// Submit question - ENHANCED VERSION

document.getElementById('submitQuestion').addEventListener('click', submitQuestion);

}

// FIX: Setup Quick Access Cards functionality

function setupQuickAccessCards() {

const featureCards = document.querySelectorAll('.feature-card');

featureCards.forEach(card => {

card.addEventListener('click', function() {

const cardTitle = this.querySelector('h4').textContent.toLowerCase();

// Map card titles to sections

if (cardTitle.includes('question') || cardTitle.includes('प्रश्न') || cardTitle.includes('ചോദ്യ')) {

showSection('ask-question');

} else if (cardTitle.includes('weather') || cardTitle.includes('मौसम') || cardTitle.includes('കാലാവസ്ഥ')) {

showSection('resources');

// Scroll to weather section after navigation

setTimeout(() => {

const weatherSection = document.querySelector('#weatherTitle');

if (weatherSection) {

weatherSection.scrollIntoView({ behavior: 'smooth' });

}

}, 500);

} else if (cardTitle.includes('price') || cardTitle.includes('मूल्य') || cardTitle.includes('വില')) {

showSection('resources');

// Scroll to market prices section after navigation

setTimeout(() => {

const marketSection = document.querySelector('#marketTitle');

if (marketSection) {

marketSection.scrollIntoView({ behavior: 'smooth' });

}

}, 500);

} else if (cardTitle.includes('expert') || cardTitle.includes('विशेषज्ञ') || cardTitle.includes('വിദഗ്ധ')) {

showSection('dashboard');

}

// Visual feedback

this.style.transform = 'scale(0.95)';

setTimeout(() => {

this.style.transform = 'translateY(-4px)';

}, 150);

});

// Add hover effect

card.style.cursor = 'pointer';

card.addEventListener('mouseenter', function() {

this.style.transform = 'translateY(-4px)';

});

card.addEventListener('mouseleave', function() {

this.style.transform = 'translateY(0)';

});

});

}

// FIX: Setup Image Upload functionality

function setupImageUpload() {

const imageFile = document.getElementById('imageFile');

const uploadArea = document.getElementById('uploadArea');

if (!imageFile || !uploadArea) return;

// Click to upload

uploadArea.addEventListener('click', function(e) {

e.preventDefault();

e.stopPropagation();

imageFile.click();

});

// Drag and drop

uploadArea.addEventListener('dragover', handleDragOver);

uploadArea.addEventListener('drop', handleDrop);

uploadArea.addEventListener('dragleave', handleDragLeave);

// File input change

imageFile.addEventListener('change', handleImageSelect);

// Remove image button

const removeImageBtn = document.getElementById('removeImage');

if (removeImageBtn) {

removeImageBtn.addEventListener('click', removeImage);

}

}

// Language switching

function switchLanguage(lang) {

currentLanguage = lang;

// Update active language button

document.querySelectorAll('.lang-btn').forEach(btn => {

btn.classList.remove('active');

});

document.querySelector(`[data-lang="${lang}"]`).classList.add('active');

updateLanguage(lang);

populateDropdowns();

renderSchemesList(lang);

}

// Update language content

function updateLanguage(lang) {

Object.keys(translations).forEach(key => {

const element = document.getElementById(key);

if (element && translations[key][lang]) {

if (element.tagName === 'INPUT' && element.type === 'text') {

element.placeholder = translations[key][lang];

} else {

element.textContent = translations[key][lang];

}

}

});

// new code

// ...inside updateLanguage(lang)...

const loginIds = [

"loginTitle", "loginDesc", "loginMobileLabel", "loginSendOtp", "loginOtpLabel", "loginBtn", "loginFooter", "loginSignUpLink"

];

loginIds.forEach(id => {

const el = document.getElementById(id);

if (el && translations[id] && translations[id][lang]) {

el.textContent = translations[id][lang];

}

});

const signupIds = [

"signupTitle", "signupDesc", "signupNameLabel", "signupMobileLabel", "signupSendOtp", "signupOtpLabel", "signupEmailLabel", "signupBtn", "signupFooter", "signupLoginLink"

];

signupIds.forEach(id => {

const el = document.getElementById(id);

if (el && translations[id] && translations[id][lang]) {

el.textContent = translations[id][lang];

}

});

const contactIds = [

"contactTitle", "contactDesc", "contactViaEmail", "contactViaMobile", "contactNameLabel", "contactMobileLabel", "contactMessageLabel", "contactSendEmail", "contactEmailInfo", "contactMobileInfo", "contactMobileNumber"

];

contactIds.forEach(id => {

const el = document.getElementById(id);

if (el && translations[id] && translations[id][lang]) {

el.textContent = translations[id][lang];

}

});

// new code

// Update placeholders and other dynamic content

const questionText = document.getElementById('questionText');

if (questionText) {

const placeholders = {

ml: "നിങ്ങളുടെ ചോദ്യം ഇവിടെ ടൈപ്പ് ചെയ്യുക...",

hi: "अपना प्रश्न यहाँ टाइप करें...",

en: "Type your question here..."

};

questionText.placeholder = placeholders[lang];

}

}

function renderSchemesList(lang) {

const schemesList = document.querySelector('.schemes-list');

if (!schemesList) return;

schemesList.innerHTML = '';

schemesData[lang].forEach(scheme => {

const item = document.createElement('div');

item.className = 'scheme-item';

item.innerHTML = `

<a href="${scheme.url}" target="_blank" rel="noopener">

<h4>${scheme.title}</h4>

<p>${scheme.desc}</p>

</a>

`;

schemesList.appendChild(item);

});

}

// Populate dropdowns

function populateDropdowns() {

const placeholders = {

crop: {

ml: "വിള തിരഞ്ഞെടുക്കുക...",

hi: "फसल चुनें...",

en: "Choose crop..."

},

stage: {

ml: "ഘട്ടം തിരഞ്ഞെടുക്കുക...",

hi: "चरण चुनें...",

en: "Choose stage..."

},

location: {

ml: "സ്ഥലം തിരഞ്ഞെടുക്കുക...",

hi: "स्थान चुनें...",

en: "Choose location..."

}

};

populateDropdown('cropSelect', crops[currentLanguage], placeholders.crop[currentLanguage]);

populateDropdown('stageSelect', farmingStages[currentLanguage], placeholders.stage[currentLanguage]);

populateDropdown('locationSelect', locations[currentLanguage], placeholders.location[currentLanguage]);

}

function populateDropdown(selectId, options, placeholder) {

const select = document.getElementById(selectId);

if (!select) return;

select.innerHTML = `<option value="">${placeholder}</option>`;

options.forEach(option => {

const optionElement = document.createElement('option');

optionElement.value = option;

optionElement.textContent = option;

select.appendChild(optionElement);

});

}

// Navigation

function showSection(sectionId) {

// Update current section

currentSection = sectionId;

// Hide all sections

document.querySelectorAll('.section').forEach(section => {

section.classList.remove('active');

});

// Show target section

const targetSection = document.getElementById(sectionId);

if (targetSection) {

targetSection.classList.add('active');

}

// Update navigation

document.querySelectorAll('.nav-link').forEach(link => {

link.classList.remove('active');

if (link.getAttribute('href') === `#${sectionId}`) {

link.classList.add('active');

}

});

// Scroll to top

window.scrollTo({ top: 0, behavior: 'smooth' });

}

// Input method switching

function switchInputMethod(method) {

// Update active tab

document.querySelectorAll('.method-tab').forEach(tab => {

tab.classList.remove('active');

});

document.querySelector(`[data-method="${method}"]`).classList.add('active');

// Show corresponding input method

document.querySelectorAll('.input-method').forEach(inputMethod => {

inputMethod.classList.remove('active');

});

document.getElementById(`${method}-input`).classList.add('active');

}

// Voice recording functionality

async function toggleRecording() {

if (!isRecording) {

try {

const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

mediaRecorder = new MediaRecorder(stream);

recordedChunks = [];

mediaRecorder.ondataavailable = function(event) {

if (event.data.size > 0) {

recordedChunks.push(event.data);

}

};

mediaRecorder.onstop = function() {

const blob = new Blob(recordedChunks, { type: 'audio/webm' });

// Here you would typically upload the blob to your server

console.log('Recording stopped, blob created:', blob);

showNotification('Recording saved successfully!', 'success');

};

mediaRecorder.start();

startRecording();

} catch (error) {

console.error('Error accessing microphone:', error);

showNotification('Error accessing microphone. Please check permissions.', 'error');

}

} else {

stopRecording();

}

}

function startRecording() {

isRecording = true;

const recordBtn = document.getElementById('recordBtn');

const recordText = document.getElementById('recordText');

const waveform = document.getElementById('waveform');

recordBtn.classList.add('recording');

recordText.textContent = 'Recording... Click to stop';

waveform.classList.remove('hidden');

}

function stopRecording() {

isRecording = false;

const recordBtn = document.getElementById('recordBtn');

const recordText = document.getElementById('recordText');

const waveform = document.getElementById('waveform');

if (mediaRecorder && mediaRecorder.state !== 'inactive') {

mediaRecorder.stop();

mediaRecorder.stream.getTracks().forEach(track => track.stop());

}

recordBtn.classList.remove('recording');

recordText.textContent = translations.recordText[currentLanguage];

waveform.classList.add('hidden');

}

// Image upload functionality

function handleDragOver(e) {

e.preventDefault();

e.stopPropagation();

e.currentTarget.style.borderColor = 'var(--color-primary)';

e.currentTarget.style.background = 'var(--color-bg-1)';

}

function handleDragLeave(e) {

e.preventDefault();

e.stopPropagation();

e.currentTarget.style.borderColor = 'var(--color-border)';

e.currentTarget.style.background = 'transparent';

}

function handleDrop(e) {

e.preventDefault();

e.stopPropagation();

const uploadArea = e.currentTarget;

uploadArea.style.borderColor = 'var(--color-border)';

uploadArea.style.background = 'transparent';

const files = e.dataTransfer.files;

if (files.length > 0 && files[0].type.startsWith('image/')) {

handleImageFile(files[0]);

} else {

showNotification('Please select a valid image file (JPG, PNG, JPEG)', 'warning');

}

}

function handleImageSelect(e) {

const file = e.target.files[0];

if (file && file.type.startsWith('image/')) {

handleImageFile(file);

} else if (file) {

showNotification('Please select a valid image file (JPG, PNG, JPEG)', 'warning');

}

}

function handleImageFile(file) {

// Check file size (limit to 5MB)

if (file.size > 5 * 1024 * 1024) {

showNotification('File size too large. Please select an image under 5MB.', 'warning');

return;

}

const reader = new FileReader();

reader.onload = function(e) {

const uploadArea = document.getElementById('uploadArea');

const imagePreview = document.getElementById('imagePreview');

const previewImg = document.getElementById('previewImg');

if (uploadArea && imagePreview && previewImg) {

previewImg.src = e.target.result;

uploadArea.classList.add('hidden');

imagePreview.classList.remove('hidden');

showNotification('Image uploaded successfully!', 'success');

}

};

reader.onerror = function() {

showNotification('Error reading file. Please try again.', 'error');

};

reader.readAsDataURL(file);

}

function removeImage() {

const uploadArea = document.getElementById('uploadArea');

const imagePreview = document.getElementById('imagePreview');

const imageFile = document.getElementById('imageFile');

const previewImg = document.getElementById('previewImg');

if (uploadArea && imagePreview && imageFile && previewImg) {

uploadArea.classList.remove('hidden');

imagePreview.classList.add('hidden');

imageFile.value = '';

previewImg.src = '';

showNotification('Image removed', 'info');

}

}

// Auto-location functionality

function getAutoLocation() {

if (!navigator.geolocation) {

showNotification('Geolocation is not supported by this browser.', 'error');

return;

}

showNotification('Getting your location...', 'info');

navigator.geolocation.getCurrentPosition(

function(position) {

// In a real application, you would reverse geocode these coordinates

const lat = position.coords.latitude;

const lon = position.coords.longitude;

// For demo purposes, set a default location

const locationSelect = document.getElementById('locationSelect');

if (locationSelect && locations[currentLanguage].length > 0) {

locationSelect.value = locations[currentLanguage][0]; // Set first location as default

showNotification('Location detected successfully!', 'success');

}

},

function(error) {

console.error('Geolocation error:', error);

showNotification('Unable to get your location. Please select manually.', 'warning');

}

);

}

// ENHANCED Submit Question Function with AI Response
function submitQuestion() {
    const activeMethod = document.querySelector('.method-tab.active').getAttribute('data-method');
    const crop = document.getElementById('cropSelect').value;
    const stage = document.getElementById('stageSelect').value;
    const location = document.getElementById('locationSelect').value;
    
    let questionContent = '';
    let hasContent = false;

    // Validate input based on method
    switch (activeMethod) {
        case 'text':
            questionContent = document.getElementById('questionText').value.trim();
            hasContent = questionContent.length > 0;
            break;
        case 'voice':
            hasContent = recordedChunks.length > 0;
            questionContent = 'Voice recording submitted';
            break;
        case 'image':
            const imagePreview = document.getElementById('imagePreview');
            hasContent = imagePreview && !imagePreview.classList.contains('hidden');
            questionContent = 'Image submitted for analysis';
            break;
    }

    // Validate required fields
    if (!hasContent) {
        showNotification('Please provide your question using the selected method.', 'warning');
        return;
    }

    // Show processing message
    showNotification('Processing your question...', 'info');
    
    // Create AI response container
    const responseContainer = createResponseContainer();
    
    // Generate AI response
    setTimeout(() => {
        let aiResponse = '';
        
        if (activeMethod === 'text') {
            aiResponse = generateAIResponse(questionContent, crop, stage, location);
        } else if (activeMethod === 'image') {
            // Simulate image analysis response
            const imageAnalysisResponses = {
                en: `Image Analysis Complete: I can see your crop image. Based on visual analysis, this appears to be a ${crop || 'plant'} showing potential signs of nutrient deficiency or pest damage. I recommend applying organic neem oil spray and checking soil moisture levels. For detailed diagnosis, please consult your local agricultural officer with the actual plant sample.`,
                hi: `छवि विश्लेषण पूर्ण: मैं आपकी फसल की छवि देख सकता हूं। दृश्य विश्लेषण के आधार पर, यह ${crop || 'पौधा'} पोषक तत्वों की कमी या कीट क्षति के संभावित संकेत दिखा रहा है। मैं जैविक नीम तेल का छिड़काव करने और मिट्टी की नमी के स्तर की जांच करने की सिफारिश करता हूं।`,
                ml: `ചിത്ര വിശകലനം പൂർത്തിയായി: നിങ്ങളുടെ വിള ചിത്രം എനിക്ക് കാണാൻ കഴിയും. വിഷ്വൽ വിശകലനത്തിന്റെ അടിസ്ഥാനത്തിൽ, ഇത് ${crop || 'ചെടിയിൽ'} പോഷക കുറവോ കീടബാധയോ ഉണ്ടാകാനുള്ള സാധ്യത കാണിക്കുന്നു. ജൈവ വേപ്പെണ്ണ തളിക്കാനും മണ്ണിന്റെ ഈർപ്പം പരിശോധിക്കാനും ഞാൻ ശുപാർശ ചെയ്യുന്നു.`
            };
            aiResponse = imageAnalysisResponses[currentLanguage];
        } else if (activeMethod === 'voice') {
            // Simulate voice recognition response
            const voiceResponses = {
                en: `Voice message received and processed. Based on your spoken query about ${crop || 'agricultural matters'}, our AI system has analyzed your concern. For accurate voice-based consultation and personalized advice, please call our expert helpline at 1800-180-1551 where our agricultural specialists can provide detailed guidance.`,
                hi: `आवाज संदेश प्राप्त और संसाधित हुआ। ${crop || 'कृषि मामलों'} के बारे में आपके बोले गए प्रश्न के आधार पर, हमारे AI सिस्टम ने आपकी चिंता का विश्लेषण किया है। सटीक आवाज-आधारित परामर्श और व्यक्तिगत सलाह के लिए, कृपया हमारी विशेषज्ञ हेल्पलाइन 1800-180-1551 पर कॉल करें।`,
                ml: `വോയ്‌സ് മെസേജ് സ്വീകരിച്ച് പ്രോസസ് ചെയ്തു. ${crop || 'കാർഷിക കാര്യങ്ങളെ'}ക്കുറിച്ചുള്ള നിങ്ങളുടെ സംസാര ചോദ്യത്തിന്റെ അടിസ്ഥാനത്തിൽ, ഞങ്ങളുടെ AI സിസ്റ്റം നിങ്ങളുടെ ആശങ്ക വിശകലനം ചെയ്തിട്ടുണ്ട്. കൃത്യമായ വോയ്‌സ് അടിസ്ഥാനമാക്കിയുള്ള കൺസൾട്ടേഷനും വ്യക്തിഗത ഉപദേശവും ലഭിക്കാൻ, ഞങ്ങളുടെ വിദഗ്ധ ഹെൽപ്പ്ലൈൻ 1800-180-1551 ൽ വിളിക്കുക.`
            };
            aiResponse = voiceResponses[currentLanguage];
        }
        
        displayAIResponse(responseContainer, aiResponse, questionContent, {
            method: activeMethod,
            crop: crop,
            stage: stage,
            location: location
        });
        
        // Clear form after successful submission
        clearQuestionForm();
        
    }, 2000); // 2 second delay to simulate AI processing
}

// Create response container
function createResponseContainer() {
    // Remove existing response if any
    const existingResponse = document.getElementById('ai-response-container');
    if (existingResponse) {
        existingResponse.remove();
    }
    
    // Create new response container
    const container = document.createElement('div');
    container.id = 'ai-response-container';
    container.className = 'ai-response-container';
    container.style.cssText = `
        background: #f8f9fa;
        border: 2px solid #28a745;
        border-radius: 12px;
        margin: 20px 0;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.1);
        animation: fadeIn 0.5s ease-in-out;
    `;
    
    // Insert after question form
    const questionPanel = document.querySelector('.question-panel');
    questionPanel.appendChild(container);
    
    return container;
}

// Display AI response
function displayAIResponse(container, response, question, metadata) {
    const responseHTML = `
        <div class="ai-response-header" style="margin-bottom: 15px;">
            <h3 style="color: #28a745; margin: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-robot"></i> 
                ${currentLanguage === 'en' ? 'AI Agricultural Advisor Response' : 
                  currentLanguage === 'hi' ? 'AI कृषि सलाहकार प्रतिक्रिया' : 
                  'AI കാർഷിക ഉപദേശക പ്രതികരണം'}
            </h3>
            <div style="font-size: 0.9rem; color: #6c757d; margin-top: 5px;">
                ${currentLanguage === 'en' ? 'Response generated in' : 
                  currentLanguage === 'hi' ? 'प्रतिक्रिया में उत्पन्न' : 
                  'പ്രതികരണം ഉത്പാദിപ്പിച്ചത്'}: ${currentLanguage === 'en' ? 'English' : currentLanguage === 'hi' ? 'हिन्दी' : 'മലയാളം'}
            </div>
        </div>
        
        <div class="question-summary" style="background: #e9ecef; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
            <strong style="color: #495057;">
                ${currentLanguage === 'en' ? 'Your Question:' : 
                  currentLanguage === 'hi' ? 'आपका प्रश्न:' : 
                  'നിങ്ങളുടെ ചോദ്യം:'}
            </strong>
            <div style="margin-top: 8px; font-style: italic;">"${question}"</div>
            ${metadata.crop || metadata.stage || metadata.location ? `<div style="font-size: 0.85rem; color: #6c757d; margin-top: 8px; padding-top: 8px; border-top: 1px solid #dee2e6;">
                ${metadata.crop ? `<span><strong>${currentLanguage === 'en' ? 'Crop:' : currentLanguage === 'hi' ? 'फसल:' : 'വിള:'}</strong> ${metadata.crop}</span>` : ''}
                ${metadata.crop && (metadata.stage || metadata.location) ? ' | ' : ''}
                ${metadata.stage ? `<span><strong>${currentLanguage === 'en' ? 'Stage:' : currentLanguage === 'hi' ? 'चरण:' : 'ഘട്ടം:'}</strong> ${metadata.stage}</span>` : ''}
                ${metadata.stage && metadata.location ? ' | ' : ''}
                ${metadata.location ? `<span><strong>${currentLanguage === 'en' ? 'Location:' : currentLanguage === 'hi' ? 'स्थान:' : 'സ്ഥലം:'}</strong> ${metadata.location}</span>` : ''}
            </div>` : ''}
        </div>
        
        <div class="ai-response-content" style="line-height: 1.8; color: #333; font-size: 16px; background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
            ${response}
        </div>
        
        <div class="response-actions" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
            <button onclick="askFollowUp()" class="btn btn--outline" style="font-size: 0.9rem; padding: 8px 16px;">
                <i class="fas fa-comment"></i> 
                ${currentLanguage === 'en' ? 'Ask Follow-up' : 
                  currentLanguage === 'hi' ? 'अनुवर्ती प्रश्न' : 
                  'തുടർ ചോദ്യം'}
            </button>
            <button onclick="contactExpert()" class="btn btn--outline" style="font-size: 0.9rem; padding: 8px 16px;">
                <i class="fas fa-user-tie"></i> 
                ${currentLanguage === 'en' ? 'Contact Expert' : 
                  currentLanguage === 'hi' ? 'विशेषज्ञ संपर्क' : 
                  'വിദഗ്ധനെ ബന്ധപ്പെടുക'}
            </button>
            <button onclick="saveResponse()" class="btn btn--outline" style="font-size: 0.9rem; padding: 8px 16px;">
                <i class="fas fa-save"></i> 
                ${currentLanguage === 'en' ? 'Save Response' : 
                  currentLanguage === 'hi' ? 'सहेजें' : 
                  'സംരക്ഷിക്കുക'}
            </button>
        </div>
    `;
    
    container.innerHTML = responseHTML;
    
    // Add CSS animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    `;
    document.head.appendChild(style);
    
    // Scroll to response
    setTimeout(() => {
        container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
    
    // Show success notification
    showNotification(
        currentLanguage === 'en' ? 'AI response generated successfully!' :
        currentLanguage === 'hi' ? 'AI प्रतिक्रिया सफलतापूर्वक उत्पन्न!' :
        'AI പ്രതികരണം വിജയകരമായി ഉത്പാദിപ്പിച്ചു!',
        'success'
    );
}

// Follow-up question function
function askFollowUp() {
    // Clear the current question form and scroll back to it
    clearQuestionForm();
    document.getElementById('questionText').focus();
    const placeholders = {
        en: 'Ask your follow-up question here...',
        hi: 'अपना अनुवर्ती प्रश्न यहाँ पूछें...',
        ml: 'നിങ്ങളുടെ തുടർ ചോദ്യം ഇവിടെ ചോദിക്കുക...'
    };
    document.getElementById('questionText').placeholder = placeholders[currentLanguage];
    
    // Scroll to question form
    document.querySelector('.question-panel').scrollIntoView({ behavior: 'smooth' });
}

// Contact expert function  
function contactExpert() {
    showSection('ContactUs');
    showNotification(
        currentLanguage === 'en' ? 'Redirecting to contact expert section...' : 
        currentLanguage === 'hi' ? 'विशेषज्ञ संपर्क अनुभाग पर भेजा जा रहा है...' : 
        'വിദഗ്ധ ബന്ധപ്പെടാൻ വിഭാഗത്തിലേക്ക് റീഡയറക്ട് ചെയ്യുന്നു...', 
        'info'
    );
}

// Save response function
function saveResponse() {
    const responseContent = document.querySelector('#ai-response-container .ai-response-content');
    if (responseContent) {
        const responseText = responseContent.textContent;
        const timestamp = new Date().toLocaleString();
        
        // In a real application, this would save to database/localStorage
        console.log('Saving response:', { 
            response: responseText, 
            timestamp: timestamp,
            language: currentLanguage 
        });
        
        // Store in localStorage for demo
        const savedResponses = JSON.parse(localStorage.getItem('krishiResponses') || '[]');
        savedResponses.push({
            response: responseText,
            timestamp: timestamp,
            language: currentLanguage
        });
        localStorage.setItem('krishiResponses', JSON.stringify(savedResponses));
    }
    
    showNotification(
        currentLanguage === 'en' ? 'Response saved to your dashboard!' : 
        currentLanguage === 'hi' ? 'प्रतिक्रिया आपके डैशबोर्ड में सहेजी गई!' : 
        'പ്രതികരണം നിങ്ങളുടെ ഡാഷ്ബോർഡിൽ സംരക്ഷിച്ചു!', 
        'success'
    );
}

// Clear question form

function clearQuestionForm() {

const questionText = document.getElementById('questionText');

const cropSelect = document.getElementById('cropSelect');

const stageSelect = document.getElementById('stageSelect');

const locationSelect = document.getElementById('locationSelect');

if (questionText) questionText.value = '';

if (cropSelect) cropSelect.value = '';

if (stageSelect) stageSelect.value = '';

if (locationSelect) locationSelect.value = '';

// Reset image upload

removeImage();

// Reset voice recording

if (isRecording) {

stopRecording();

}

recordedChunks = [];

// Reset to text input method

switchInputMethod('text');

// Reset placeholder
const placeholders = {
    ml: "നിങ്ങളുടെ ചോദ്യം ഇവിടെ ടൈപ്പ് ചെയ്യുക...",
    hi: "अपना प्रश्न यहाँ टाइप करें...",
    en: "Type your question here..."
};
if (questionText) {
    questionText.placeholder = placeholders[currentLanguage];
}

}

// Notification system

function showNotification(message, type = 'info') {

// Create notification element

const notification = document.createElement('div');

notification.className = `notification notification--${type}`;

notification.innerHTML = `

<div class="notification__content">

<span class="notification__icon">

${type === 'success' ? '<i class="fas fa-check-circle"></i>' :

type === 'error' ? '<i class="fas fa-exclamation-circle"></i>' :

type === 'warning' ? '<i class="fas fa-exclamation-triangle"></i>' :

'<i class="fas fa-info-circle"></i>'}

</span>

<span class="notification__message">${message}</span>

<button class="notification__close" onclick="this.parentElement.parentElement.remove()">

<i class="fas fa-times"></i>

</button>

</div>

`;

// Add styles

const style = document.createElement('style');

if (!document.getElementById('notification-styles')) {

style.id = 'notification-styles';

style.textContent = `

.notification {

position: fixed;

top: 20px;

right: 20px;

min-width: 300px;

max-width: 500px;

padding: 16px;

border-radius: 8px;

box-shadow: 0 4px 12px rgba(0,0,0,0.15);

z-index: 1000;

animation: slideInRight 0.3s ease-out;

}

.notification--info {

background: #e3f2fd;

border-left: 4px solid #2196f3;

color: #1565c0;

}

.notification--success {

background: #e8f5e9;

border-left: 4px solid #4caf50;

color: #2e7d32;

}

.notification--warning {

background: #fff3e0;

border-left: 4px solid #ff9800;

color: #ef6c00;

}

.notification--error {

background: #ffebee;

border-left: 4px solid #f44336;

color: #c62828;

}

.notification__content {

display: flex;

align-items: center;

gap: 12px;

}

.notification__icon {

font-size: 18px;

}

.notification__message {

flex: 1;

font-weight: 500;

}

.notification__close {

background: none;

border: none;

cursor: pointer;

font-size: 14px;

opacity: 0.7;

padding: 4px;

}

.notification__close:hover {

opacity: 1;

}

@keyframes slideInRight {

from {

transform: translateX(100%);

opacity: 0;

}

to {

transform: translateX(0);

opacity: 1;

}

}

`;

document.head.appendChild(style);

}

// Add to body

document.body.appendChild(notification);

// Auto remove after 5 seconds

setTimeout(() => {

if (notification.parentElement) {

notification.remove();

}

}, 5000);

}

// Theme toggle functionality

function toggleTheme() {

const body = document.body;

const currentTheme = body.getAttribute('data-theme');

const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

body.setAttribute('data-theme', newTheme);

// Update button icon

const themeBtn = document.getElementById('themeToggleBtn');

if (themeBtn) {

const icon = themeBtn.querySelector('i');

if (newTheme === 'dark') {

icon.classList.remove('fa-moon');

icon.classList.add('fa-sun');

} else {

icon.classList.remove('fa-sun');

icon.classList.add('fa-moon');

}

}

// Save preference

localStorage.setItem('theme', newTheme);

}

// Load saved theme

function loadSavedTheme() {

const savedTheme = localStorage.getItem('theme') || 'light';

document.body.setAttribute('data-theme', savedTheme);

const themeBtn = document.getElementById('themeToggleBtn');

if (themeBtn) {

const icon = themeBtn.querySelector('i');

if (savedTheme === 'dark') {

icon.classList.remove('fa-moon');

icon.classList.add('fa-sun');

} else {

icon.classList.remove('fa-sun');

icon.classList.add('fa-moon');

}

}

}

// Initialize theme on load

document.addEventListener('DOMContentLoaded', function() {

loadSavedTheme();

const themeBtn = document.getElementById('themeToggleBtn');

if (themeBtn) {

themeBtn.addEventListener('click', toggleTheme);

}

});


// Digital Krishi Officer - Enhanced AI System with Complete Agricultural Knowledge

// Keep all your existing translations and data exactly the same - only adding enhanced AI functions

// COMPREHENSIVE AGRICULTURAL KNOWLEDGE BASE - FULLY TRAINED AI
const comprehensiveAgriculturalKnowledge = {
    // Detailed crop-specific disease database
    cropDiseases: {
        rice: {
            en: {
                blast: "Rice Blast Disease Treatment:\n• Apply Tricyclazole 75% WP @ 0.6g/L during tillering stage\n• Use resistant varieties: Jyoti, Rohini, Priyanka\n• Maintain proper field drainage, avoid water stagnation\n• Apply Silicon-based fertilizers to strengthen plant immunity\n• Spray preventively before monsoon season\n• Remove affected plant debris and burn safely",
                blight: "Rice Bacterial Blight:\n• Apply Streptocycline 300ppm + Copper oxychloride 2g/L\n• Use certified disease-free seeds\n• Maintain 2-3 cm water level consistently\n• Apply potash fertilizer to boost plant resistance\n• Practice crop rotation with legumes\n• Avoid excessive nitrogen fertilization",
                brownspot: "Brown Spot Disease:\n• Apply Mancozeb 75% WP @ 2g/L every 10 days\n• Ensure balanced NPK nutrition (avoid potassium deficiency)\n• Improve soil drainage and aeration\n• Use resistant varieties like IR64, Swarna\n• Apply organic matter to improve soil health"
            },
            hi: {
                blast: "धान ब्लास्ट रोग उपचार:\n• कल्ले फूटते समय ट्राइसाइक्लाजोल 75% WP @ 0.6g/L का छिड़काव करें\n• प्रतिरोधी किस्में उगाएं: ज्योति, रोहिणी, प्रियंका\n• खेत में उचित जल निकासी बनाए रखें\n• पौधों की प्रतिरक्षा बढ़ाने के लिए सिलिकॉन आधारित उर्वरक का प्रयोग करें\n• मानसून से पहले रोकथाम के लिए छिड़काव करें\n• रोगग्रस्त पौधों के अवशेषों को हटाकर जला दें",
                blight: "धान जीवाणु झुलसा:\n• स्ट्रेप्टोसाइक्लिन 300ppm + कॉपर ऑक्सीक्लोराइड 2g/L का छिड़काव करें\n• प्रमाणित रोग मुक्त बीज का उपयोग करें\n• लगातार 2-3 सेमी पानी का स्तर बनाए रखें\n• पौधों का प्रतिरोध बढ़ाने के लिए पोटाश उर्वरक का प्रयोग करें\n• दलहनी फसलों के साथ फसल चक्र अपनाएं"
            },
            ml: {
                blast: "നെൽ ബ്ലാസ്റ്റ് രോഗ ചികിത്സ:\n• കുലപിരിവ് ഘട്ടത്തിൽ ട്രൈസൈക്ലാസോൾ 75% WP @ 0.6g/L തളിക്കുക\n• പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ ഉപയോഗിക്കുക: ജ്യോതി, രോഹിണി, പ്രിയങ്ക\n• വയലിൽ ശരിയായ ജലനിർഗമനം ഉറപ്പാക്കുക\n• ചെടികളുടെ പ്രതിരോധശേഷി വർദ്ധിപ്പിക്കാൻ സിലിക്കൺ അടിസ്ഥാനമാക്കിയ വളം ഉപയോഗിക്കുക\n• മഴക്കാലത്തിന് മുമ്പ് പ്രതിരോധ തളികൽ നടത്തുക\n• രോഗബാധിത ചെടിയുടെ അവശിഷ്ടങ്ങൾ നീക്കം ചെയ്ത് സുരക്ഷിതമായി കത്തിക്കുക",
                blight: "നെൽ ബാക്ടീരിയ കേടുപാട്:\n• സ്ട്രെപ്റ്റോസൈക്ലിൻ 300ppm + കോപ്പർ ഓക്സിക്ലോറൈഡ് 2g/L തളിക്കുക\n• സാക്ഷ്യപത്രമുള്ള രോഗരഹിത വിത്ത് ഉപയോഗിക്കുക\n• തുടർച്ചയായി 2-3 സെ.മീ ജലനിരപ്പ് നിലനിർത്തുക\n• ചെടികളുടെ പ്രതിരോധശേഷി വർദ്ധിപ്പിക്കാൻ പൊട്ടാഷ് വളം പ്രയോഗിക്കുക\n• പയറുവർഗ്ഗ വിളകളുമായി വിളക്രമം സ്വീകരിക്കുക"
            }
        },
        banana: {
            en: {
                leaf_spot: "Banana Leaf Spot (Sigatoka):\n• Apply Propiconazole 25% EC @ 1ml/L every 15 days\n• Remove affected lower leaves immediately\n• Ensure proper spacing between plants (2.5m x 2.5m)\n• Improve air circulation and drainage\n• Apply balanced fertilizer with adequate potassium\n• Use drip irrigation to avoid wetting leaves\n• Spray early morning or evening to avoid leaf burn",
                panama: "Panama Disease (Fusarium Wilt):\n• No chemical cure available - focus on prevention\n• Use tissue culture disease-free planting material\n• Practice strict field sanitation\n• Avoid movement of soil and tools between plots\n• Plant resistant varieties like FHIA-03, FHIA-21\n• Improve soil drainage and organic matter\n• Remove and destroy affected plants immediately",
                bunchy_top: "Banana Bunchy Top Virus:\n• Control aphid vectors using Imidacloprid 17.8% SL @ 0.5ml/L\n• Remove infected plants immediately and destroy\n• Use virus-free planting material only\n• Maintain distance from infected gardens\n• Apply reflective mulch to repel aphids\n• Monitor regularly for early detection"
            },
            hi: {
                leaf_spot: "केला पत्ती धब्बा (सिगाटोका):\n• प्रोपिकोनाजोल 25% EC @ 1ml/L का हर 15 दिन में छिड़काव करें\n• प्रभावित निचली पत्तियों को तुरंत हटाएं\n• पौधों के बीच उचित दूरी बनाए रखें (2.5m x 2.5m)\n• हवा का संचार और जल निकासी में सुधार करें\n• पर्याप्त पोटेशियम के साथ संतुलित उर्वरक का प्रयोग करें\n• पत्तियों को भिगोने से बचने के लिए ड्रिप सिंचाई का उपयोग करें",
                panama: "पनामा रोग (फ्यूजेरियम विल्ट):\n• कोई रासायनिक इलाज उपलब्ध नहीं - रोकथाम पर ध्यान दें\n• टिश्यू कल्चर रोग मुक्त रोपण सामग्री का उपयोग करें\n• खेत में कड़ी सफाई का अभ्यास करें\n• प्लॉट्स के बीच मिट्टी और उपकरणों की आवाजाही से बचें\n• प्रतिरोधी किस्में जैसे FHIA-03, FHIA-21 लगाएं"
            },
            ml: {
                leaf_spot: "വാഴ ഇലപ്പാട് (സിഗാറ്റോക്ക):\n• പ്രോപികോനാസോൾ 25% EC @ 1ml/L 15 ദിവസത്തിലൊരിക്കൽ തളിക്കുക\n• രോഗബാധിതമായ താഴത്തെ ഇലകൾ ഉടനെ നീക്കം ചെയ്യുക\n• ചെടികൾക്കിടയിൽ ശരിയായ അകലം പാലിക്കുക (2.5m x 2.5m)\n• വായു സഞ്ചാരവും ജലനിർഗമനും മെച്ചപ്പെടുത്തുക\n• ആവശ്യത്തിന് പൊട്ടാസ്യമുള്ള സമതുലിതമായ വളം പ്രയോഗിക്കുക\n• ഇലകൾ നനയാതിരിക്കാൻ ഡ്രിപ് ജലസേചനം ഉപയോഗിക്കുക",
                panama: "പനാമ രോഗം (ഫ്യൂസേറിയം വാട്ടം):\n• രാസ ചികിത്സ ലഭ്യമല്ല - പ്രതിരോധത്തിൽ ശ്രദ്ധ കേന്ദ്രീകരിക്കുക\n• ടിഷ്യൂ കൾച്ചർ രോഗമുക്ത നടീൽ സാമഗ്രികൾ ഉപയോഗിക്കുക\n• കയ്യെത്തിൽ കർശനമായ ശുചിത്വം പാലിക്കുക\n• തോട്ടങ്ങൾക്കിടയിൽ മണ്ണും ഉപകരണങ്ങളും കൊണ്ടുപോകാതിരിക്കുക\n• FHIA-03, FHIA-21 പോലുള്ള പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ നടുക"
            }
        },
        coconut: {
            en: {
                root_wilt: "Coconut Root Wilt Disease:\n• Inject Aureofungin-Sol (2ml + 1L water) monthly through root feeding\n• Apply Trichoderma viride @ 50g per palm every 6 months\n• Improve drainage around palm base (1.5m radius)\n• Apply organic manure 25kg per palm annually\n• Maintain mulch layer around base\n• Remove affected palms immediately to prevent spread\n• Avoid planting in waterlogged areas",
                crown_rot: "Coconut Crown Rot:\n• Apply Bordeaux mixture (1%) on affected areas\n• Ensure proper drainage and avoid water stagnation\n• Remove rotted tissues and apply fungicide\n• Avoid injury to growing points during harvesting\n• Apply systemic fungicide like Propiconazole\n• Improve overall palm nutrition with balanced fertilizer",
                bud_rot: "Coconut Bud Rot:\n• Remove all affected tissues carefully\n• Apply Bordeaux paste (20%) on wounds\n• Ensure good drainage around palm\n• Avoid overhead irrigation during rainy season\n• Apply copper-based fungicides preventively\n• Strengthen palm immunity with balanced nutrition"
            },
            hi: {
                root_wilt: "नारियल जड़ मुरझाना रोग:\n• मासिक रूप से जड़ भक्षण के माध्यम से ऑरिओफंगिन-सोल (2ml + 1L पानी) का इंजेक्शन लगाएं\n• हर 6 महीने में ट्राइकोडर्मा विरिडी @ 50g प्रति पेड़ का प्रयोग करें\n• पेड़ के आधार के चारों ओर जल निकासी में सुधार करें (1.5m त्रिज्या)\n• वार्षिक 25 किग्रा जैविक खाद प्रति पेड़ डालें\n• आधार के चारों ओर मल्च परत बनाए रखें",
                crown_rot: "नारियल मुकुट सड़न:\n• प्रभावित क्षेत्रों पर बोर्डो मिश्रण (1%) का प्रयोग करें\n• उचित जल निकासी सुनिश्चित करें और पानी के जमाव से बचें\n• सड़े हुए ऊतकों को हटाएं और फफूंदनाशक लगाएं"
            },
            ml: {
                root_wilt: "തെങ്ങ് വേരുവാടൽ രോഗം:\n• വേര് ഭക്ഷണത്തിലൂടെ മാസം തോറും ഓറിയോഫംഗിൻ-സോൾ (2ml + 1L വെള്ളം) കുത്തിവയ്പ്പ് നൽകുക\n• 6 മാസത്തിലൊരിക്കൽ ട്രൈക്കോഡർമ വിറിഡി @ 50g ഒരു മരത്തിന് പ്രയോഗിക്കുക\n• മരത്തിന്റെ ചുവട്ടിൽ ജലനിർഗമനം മെച്ചപ്പെടുത്തുക (1.5m ആരം)\n• വർഷത്തിൽ 25 കിലോ ജൈവ വളം ഒരു മരത്തിന് പ്രയോഗിക്കുക\n• ചുവട്ടിൽ മൾച്ച് പാളി പരിപാലിക്കുക",
                crown_rot: "തെങ്ങ് കിരീട ചീഞ്ഞുപോകൽ:\n• രോഗബാധിത ഭാഗങ്ങളിൽ ബോർഡോ മിശ്രിതം (1%) പ്രയോഗിക്കുക\n• ശരിയായ ജലനിർഗമനം ഉറപ്പാക്കുകയും വെള്ളക്കെട്ട് ഒഴിവാക്കുകയും ചെയ്യുക\n• ചീഞ്ഞ കോശങ്ങൾ നീക്കം ചെയ്ത് കുമിൾനാശിനി പ്രയോഗിക്കുക"
            }
        },
        pepper: {
            en: {
                quick_wilt: "Black Pepper Quick Wilt (Phytophthora):\n• Apply Metalaxyl 8% + Mancozeb 64% @ 2g/L monthly\n• Improve drainage in pepper gardens\n• Apply Trichoderma viride @ 10g per vine\n• Remove affected vines and burn immediately\n• Avoid water stagnation around vine base\n• Apply copper oxychloride during monsoon season\n• Use resistant varieties like Panniyur-1, Karimunda",
                anthracnose: "Pepper Anthracnose:\n• Apply Colletotrichum-specific fungicide during flowering\n• Harvest berries at proper maturity\n• Ensure good air circulation between vines\n• Apply copper-based fungicides preventively\n• Remove affected berries and spikes immediately\n• Practice clean cultivation and sanitation",
                root_rot: "Pepper Root Rot:\n• Apply Trichoderma-enriched organic matter\n• Improve soil drainage significantly\n• Apply copper oxychloride @ 2g/L soil drench\n• Reduce irrigation frequency during monsoon\n• Apply balanced fertilizer to strengthen roots\n• Use bio-control agents like Pseudomonas"
            },
            hi: {
                quick_wilt: "काली मिर्च त्वरित मुरझाना (फाइटोफ्थोरा):\n• मासिक रूप से मेटालैक्सिल 8% + मैंकोजेब 64% @ 2g/L का प्रयोग करें\n• काली मिर्च बागानों में जल निकासी में सुधार करें\n• ट्राइकोडर्मा विरिडी @ 10g प्रति बेल का प्रयोग करें\n• प्रभावित बेलों को हटाकर तुरंत जला दें\n• बेल के आधार के चारों ओर पानी के ठहराव से बचें",
                anthracnose: "काली मिर्च एंथ्रेक्नोज:\n• फूल आने के दौरान कॉलेटोट्राइकम-विशिष्ट फफूंदनाशक का प्रयोग करें\n• उचित परिपक्वता पर जामुन की कटाई करें\n• बेलों के बीच अच्छे हवा के संचार को सुनिश्चित करें"
            },
            ml: {
                quick_wilt: "കുരുമുളക് പെട്ടെന്നുള്ള വാട്ടം (ഫൈറ്റോഫ്തോറ):\n• മാസിക മെറ്റലാക്സിൽ 8% + മാൻകോസെബ് 64% @ 2g/L പ്രയോഗിക്കുക\n• കുരുമുളക് തോട്ടങ്ങളിൽ ജലനിർഗമനം മെച്ചപ്പെടുത്തുക\n• ട്രൈക്കോഡർമ വിറിഡി @ 10g ഒരു വള്ളിക്ക് പ്രയോഗിക്കുക\n• രോഗബാധിതമായ വള്ളികൾ നീക്കം ചെയ്ത് ഉടനെ കത്തിക്കുക\n• വള്ളിയുടെ ചുവട്ടിൽ വെള്ളക്കെട്ട് ഒഴിവാക്കുക",
                anthracnose: "കുരുമുളക് ആന്ത്രാക്നോസ്:\n• പൂവിടുന്ന സമയത്ത് കൊളെറ്റോട്രൈക്കം-നിർദ്ദിഷ്ട കുമിൾനാശിനി പ്രയോഗിക്കുക\n• ശരിയായ പക്വതയിൽ കുരുമുളക് വിളവെടുക്കുക\n• വള്ളികൾക്കിടയിൽ നല്ല വായു സഞ്ചാരം ഉറപ്പാക്കുക"
            }
        }
    },

    // Advanced fertilizer recommendations with timing
    fertilizationGuide: {
        rice: {
            en: {
                schedule: "Rice Fertilization Complete Schedule:\n\n**Land Preparation:**\n• Apply 10-15 tonnes farmyard manure per hectare\n• Basal dose: 60kg N + 30kg P2O5 + 30kg K2O per hectare\n• Apply full phosphorus and potash as basal\n\n**Growth Stages:**\n• **Tillering (20-25 DAT):** 30kg N/ha as urea\n• **Panicle Initiation (40-45 DAT):** 30kg N/ha as urea\n• **Grain Filling:** Apply 10kg K2O/ha if deficiency observed\n\n**Micronutrients:**\n• Zinc: 25kg ZnSO4/ha if deficiency\n• Iron: Foliar spray of FeSO4 2% during vegetative stage\n• Boron: 10kg Borax/ha in boron-deficient soils",
                organic: "Organic Rice Fertilization:\n• Green manuring: Grow sunhemp/cowpea before rice\n• Apply 15-20 tonnes compost per hectare\n• Use 500kg neem cake per hectare\n• Apply Azotobacter and PSB biofertilizers\n• Foliar spray of seaweed extract monthly\n• Apply rock phosphate 200kg/ha for long-term P supply"
            },
            hi: {
                schedule: "धान उर्वरक संपूर्ण अनुसूची:\n\n**भूमि तैयारी:**\n• प्रति हेक्टेयर 10-15 टन गोबर की खाद डालें\n• आधार खुराक: 60 किग्रा N + 30 किग्रा P2O5 + 30 किग्रा K2O प्रति हेक्टेयर\n• पूर्ण फास्फोरस और पोटाश आधार के रूप में डालें\n\n**वृद्धि चरण:**\n• **कल्ले फूटना (20-25 DAT):** 30 किग्रा N/हेक्टेयर यूरिया के रूप में\n• **बाली निकलना (40-45 DAT):** 30 किग्रा N/हेक्टेयर यूरिया के रूप में\n• **दाना भरना:** यदि कमी दिखे तो 10 किग्रा K2O/हेक्टेयर डालें",
                organic: "धान जैविक उर्वरीकरण:\n• हरी खाद: धान से पहले सनई/लोबिया उगाएं\n• प्रति हेक्टेयर 15-20 टन कंपोस्ट डालें\n• प्रति हेक्टेयर 500 किग्रा नीम खली का उपयोग करें\n• एज़ोटोबैक्टर और PSB जैव उर्वरकों का प्रयोग करें"
            },
            ml: {
                schedule: "നെൽ വള പൂർണ്ണ പട്ടിക:\n\n**നിലം തയ്യാറാക്കൽ:**\n• ഹെക്ടറിന് 10-15 ടൺ ഗോവളം പ്രയോഗിക്കുക\n• അടിവള: ഹെക്ടറിന് 60 കിലോ N + 30 കിലോ P2O5 + 30 കിലോ K2O\n• പൂർണ്ണ ഫോസ്ഫറസും പൊട്ടാഷും അടിവളമായി പ്രയോഗിക്കുക\n\n**വളർച്ച ഘട്ടങ്ങൾ:**\n• **കുലപിരിവ് (20-25 DAT):** 30 കിലോ N/ഹെക്ടർ യൂറിയയായി\n• **കതിർവിടൽ (40-45 DAT):** 30 കിലോ N/ഹെക്ടർ യൂറിയയായി\n• **ധാന്യം നിറയൽ:** കുറവ് കണ്ടാൽ 10 കിലോ K2O/ഹെക്ടർ പ്രയോഗിക്കുക",
                organic: "നെൽ ജൈവ വളപ്രയോഗം:\n• പച്ചവളം: നെല്ലിന് മുമ്പ് ചണം/കൗപ്പി വളർത്തുക\n• ഹെക്ടറിന് 15-20 ടൺ കമ്പോസ്റ്റ് പ്രയോഗിക്കുക\n• ഹെക്ടറിന് 500 കിലോ വേപ്പിൻ പിണ്ണാക്ക് ഉപയോഗിക്കുക\n• അസോട്ടോബാക്ടർ, PSB ജൈവവളങ്ങൾ ഉപയോഗിക്കുക"
            }
        },
        banana: {
            en: {
                monthly: "Banana Monthly Fertilization Program:\n\n**Planting Month:**\n• Apply 20kg farmyard manure + 200g bone meal per plant\n• Basal dose: 100g urea + 150g superphosphate + 100g MOP\n\n**2-4 Months:**\n• Month 2: 150g urea + 50g MOP\n• Month 3: 150g urea + 50g MOP + micronutrient foliar spray\n• Month 4: 150g urea + 100g MOP\n\n**5-8 Months (Flowering):**\n• Month 5: 200g urea + 100g MOP + 10g borax\n• Month 6: 150g urea + 150g MOP\n• Month 7: 100g urea + 100g MOP + calcium spray\n• Month 8: 50g urea + 100g MOP\n\n**Special Applications:**\n• Weekly liquid fertilizer during flowering\n• Potash increase during bunch development\n• Calcium spray to prevent physiological disorders",
                organic: "Organic Banana Nutrition:\n• Apply 30-40kg vermicompost per plant annually\n• Use banana special organic mix: 5kg neem cake + 2kg bone meal + 3kg wood ash\n• Biofertilizer application: Azospirillum + PSB + KSB\n• Foliar spray: Panchagavya 3% every 15 days\n• Mulch with coconut coir or dried leaves\n• Apply liquid seaweed fertilizer monthly"
            },
            hi: {
                monthly: "केला मासिक उर्वरक कार्यक्रम:\n\n**रोपण माह:**\n• प्रति पौधा 20 किग्रा गोबर की खाद + 200g अस्थि चूर्ण डालें\n• आधार खुराक: 100g यूरिया + 150g सुपरफॉस्फेट + 100g MOP\n\n**2-4 महीने:**\n• महीना 2: 150g यूरिया + 50g MOP\n• महीना 3: 150g यूरिया + 50g MOP + सूक्ष्म पोषक तत्व पर्णीय छिड़काव\n• महीना 4: 150g यूरिया + 100g MOP\n\n**5-8 महीने (फूल आना):**\n• महीना 5: 200g यूरिया + 100g MOP + 10g बोरेक्स\n• महीना 6: 150g यूरिया + 150g MOP\n• महीना 7: 100g यूरिया + 100g MOP + कैल्शियम स्प्रे",
                organic: "केला जैविक पोषण:\n• प्रति पौधा वार्षिक 30-40 किग्रा वर्मीकम्पोस्ट डालें\n• केला विशेष जैविक मिश्रण: 5 किग्रा नीम खली + 2 किग्रा अस्थि चूर्ण + 3 किग्रा लकड़ी की राख\n• जैव उर्वरक प्रयोग: एज़ोस्पिरिलम + PSB + KSB\n• पर्णीय छिड़काव: पंचगव्य 3% हर 15 दिन में"
            },
            ml: {
                monthly: "വാഴ മാസിക വള പദ്ധതി:\n\n**നടീൽ മാസം:**\n• ഒരു ചെടിക്ക് 20 കിലോ ഗോവളം + 200g അസ്ഥി പൊടി പ്രയോഗിക്കുക\n• അടിവള: 100g യൂറിയ + 150g സൂപ്പർഫോസ്ഫേറ്റ് + 100g MOP\n\n**2-4 മാസം:**\n• മാസം 2: 150g യൂറിയ + 50g MOP\n• മാസം 3: 150g യൂറിയ + 50g MOP + സൂക്ഷ്മ പോഷക ഇല തളികൽ\n• മാസം 4: 150g യൂറിയ + 100g MOP\n\n**5-8 മാസം (പൂവിടൽ):**\n• മാസം 5: 200g യൂറിയ + 100g MOP + 10g ബോറാക്സ്\n• മാസം 6: 150g യൂറിയ + 150g MOP\n• മാസം 7: 100g യൂറിയ + 100g MOP + കാൽസ്യം തളികൽ",
                organic: "വാഴ ജൈവ പോഷണം:\n• ഒരു ചെടിക്ക് വർഷത്തിൽ 30-40 കിലോ പുഴു വളം പ്രയോഗിക്കുക\n• വാഴ പ്രത്യേക ജൈവ മിശ്രിതം: 5 കിലോ വേപ്പിൻ പിണ്ണാക്ക് + 2 കിലോ അസ്ഥി പൊടി + 3 കിലോ വെള്ളരിക്ക\n• ജൈവവള പ്രയോഗം: അസോസ്പിരില്ലം + PSB + KSB\n• ഇല തളികൽ: പഞ്ചഗവ്യ 3% 15 ദിവസത്തിലൊരിക്കൽ"
            }
        }
    },

    // Comprehensive image analysis patterns
    imageAnalysisPatterns: {
        disease_symptoms: {
            leaf_spots: ["circular spots", "irregular patches", "yellowing", "browning", "necrotic tissue"],
            wilting: ["drooping leaves", "water stress", "vascular damage", "root problems"],
            chlorosis: ["yellow leaves", "nutrient deficiency", "iron deficiency", "nitrogen deficiency"],
            necrosis: ["dead tissue", "brown patches", "tissue death", "fungal infection"]
        },
        nutrient_deficiencies: {
            nitrogen: ["pale green", "yellowing", "stunted growth", "poor vegetative growth"],
            phosphorus: ["purplish leaves", "delayed maturity", "poor root development"],
            potassium: ["leaf burn", "marginal scorch", "yellow leaf edges", "weak stems"],
            calcium: ["blossom end rot", "tip burn", "young leaf distortion"]
        },
        pest_damage: {
            chewing: ["holes in leaves", "defoliation", "caterpillar damage", "irregular eating pattern"],
            sucking: ["stippling", "yellowing", "honeydew", "sooty mold", "distorted growth"],
            mining: ["serpentine tunnels", "leaf miner damage", "transparent patches"]
        }
    },

    // Weather-based recommendations
    weatherAdvisory: {
        en: {
            monsoon: "Monsoon Season Advisory:\n• Ensure proper drainage in all crop fields\n• Apply preventive fungicide sprays before heavy rains\n• Harvest mature crops before monsoon peaks\n• Store harvested produce in dry, well-ventilated areas\n• Avoid fertilizer application during heavy rain periods\n• Monitor for fungal diseases and take immediate action",
            summer: "Summer Season Advisory:\n• Increase irrigation frequency, prefer drip/sprinkler systems\n• Apply mulch to conserve soil moisture\n• Schedule farming activities during cooler hours\n• Monitor crops for heat stress symptoms\n• Apply foliar fertilizers in the evening\n• Harvest early morning to maintain quality",
            winter: "Winter Season Advisory:\n• Protect crops from cold waves using plastic sheets\n• Reduce irrigation frequency as evaporation is less\n• Good time for land preparation and organic matter application\n• Ideal season for transplanting and new plantings\n• Apply phosphorus-rich fertilizers for root development\n• Monitor for pest buildup in protected environments"
        },
        hi: {
            monsoon: "मानसून सीजन सलाह:\n• सभी फसल क्षेत्रों में उचित जल निकासी सुनिश्चित करें\n• भारी बारिश से पहले रोकथाम फफूंदनाशक छिड़काव करें\n• मानसून चरम से पहले परिपक्व फसलों की कटाई करें\n• कटी हुई फसल को सूखे, हवादार स्थानों में भंडारित करें\n• भारी बारिश की अवधि के दौरान उर्वरक प्रयोग से बचें",
            summer: "गर्मी सीजन सलाह:\n• सिंचाई की आवृत्ति बढ़ाएं, ड्रिप/स्प्रिंकलर सिस्टम पसंद करें\n• मिट्टी की नमी संरक्षित करने के लिए मल्च लगाएं\n• ठंडे घंटों के दौरान खेती की गतिविधियों को शेड्यूल करें\n• गर्मी तनाव के लक्षणों के लिए फसलों की निगरानी करें",
            winter: "सर्दी सीजन सलाह:\n• प्लास्टिक शीट का उपयोग करके फसलों को ठंडी लहर से बचाएं\n• सिंचाई की आवृत्ति कम करें क्योंकि वाष्पीकरण कम है\n• भूमि तैयारी और जैविक पदार्थ प्रयोग के लिए अच्छा समय\n• रोपाई और नई बुआई के लिए आदर्श मौसम"
        },
        ml: {
            monsoon: "മഴക്കാല ഉപദേശം:\n• എല്ലാ വിള വയലുകളിലും ശരിയായ ജലനിർഗമനം ഉറപ്പാക്കുക\n• കനത്ത മഴയ്ക്ക് മുമ്പ് പ്രതിരോധ കുമിൾനാശിനി തളികൽ നടത്തുക\n• മഴക്കാല കൊടുമുടിയ്ക്ക് മുമ്പ് പാകമായ വിളകൾ വിളവെടുക്കുക\n• വിളവെടുത്ത ഉൽപാദനം വരണ്ടതും വായു സഞ്ചാരമുള്ളതുമായ സ്ഥലങ്ങളിൽ സൂക്ഷിക്കുക\n• കനത്ത മഴക്കാലത്ത് വള പ്രയോഗം ഒഴിവാക്കുക",
            summer: "വേനൽക്കാല ഉപദേശം:\n• ജലസേചന ആവൃത്തി വർദ്ധിപ്പിക്കുക, ഡ്രിപ്/സ്പ്രിങ്ക്ലർ സംവിധാനങ്ങൾ മുൻഗണന നൽകുക\n• മണ്ണിന്റെ ഈർപ്പം സംരക്ഷിക്കാൻ മൾച്ച് പ്രയോഗിക്കുക\n• തണുത്ത സമയങ്ങളിൽ കൃഷി പ്രവർത്തനങ്ങൾ ഷെഡ്യൂൾ ചെയ്യുക\n• ചൂട് സമ്മർദ്ദ ലക്ഷണങ്ങൾക്കായി വിളകൾ നിരീക്ഷിക്കുക",
            winter: "ശീതകാല ഉപദേശം:\n• പ്ലാസ്റ്റിക് ഷീറ്റുകൾ ഉപയോഗിച്ച് തണുത്ത തിരമാലകളിൽ നിന്ന് വിളകളെ സംരക്ഷിക്കുക\n• ബാഷ്പീകരണം കുറവായതിനാൽ ജലസേചന ആവൃത്തി കുറയ്ക്കുക\n• നിലം തയ്യാറാക്കാനും ജൈവപദാർത്ഥം പ്രയോഗിക്കാനും നല്ല സമയം\n• നടീലിനും പുതിയ നടീലിനും അനുയോജ്യമായ കാലാവസ്ഥ"
        }
    }
};

// ADVANCED AI RESPONSE GENERATION SYSTEM
function generateAdvancedAIResponse(question, crop, stage, location, imageData = null) {
    const lang = currentLanguage;
    const lowerQuestion = question.toLowerCase();
    
    // Enhanced keyword detection with scoring system
    let responseScore = {};
    let bestResponse = '';
    let confidence = 0;

    // Image analysis if image is provided
    if (imageData) {
        return generateImageAnalysisResponse(imageData, crop, lang);
    }

    // Disease detection with detailed matching
    const diseaseKeywords = {
        en: ['disease', 'sick', 'problem', 'spot', 'yellow', 'brown', 'wilt', 'rot', 'fungus', 'pest', 'bug', 'dying', 'leaf', 'infection', 'damage', 'black', 'white', 'curl'],
        hi: ['रोग', 'बीमारी', 'समस्या', 'धब्बा', 'पीला', 'भूरा', 'मुरझाना', 'सड़न', 'कीड़ा', 'संक्रमण', 'नुकसान', 'काला', 'सफेद', 'पत्ती'],
        ml: ['രോഗം', 'അസുഖം', 'പ്രശ്നം', 'പാട്', 'മഞ്ഞ', 'തവിട്ട്', 'വാടൽ', 'ചവറ്', 'കീട', 'അണുബാധ', 'നാശം', 'കറുത്ത', 'വെള്ള', 'ഇല']
    };

    // Fertilizer detection
    const fertilizerKeywords = {
        en: ['fertilizer', 'nutrient', 'feed', 'manure', 'urea', 'npk', 'nitrogen', 'phosphorus', 'potassium', 'growth', 'yield', 'deficiency'],
        hi: ['उर्वरक', 'खाद', 'पोषक', 'यूरिया', 'नाइट्रोजन', 'फास्फोरस', 'पोटेशियम', 'विकास', 'उत्पादन', 'कमी'],
        ml: ['വളം', 'പോഷകം', 'ഗോവളം', 'യൂറിയ', 'നൈട്രജൻ', 'ഫോസ്ഫറസ്', 'പൊട്ടാസ്യം', 'വളർച്ച', 'വിളവ്', 'കുറവ്']
    };

    // Calculate disease probability
    let diseaseScore = 0;
    diseaseKeywords[lang].forEach(keyword => {
        if (lowerQuestion.includes(keyword.toLowerCase())) {
            diseaseScore++;
        }
    });

    // Calculate fertilizer probability
    let fertilizerScore = 0;
    fertilizerKeywords[lang].forEach(keyword => {
        if (lowerQuestion.includes(keyword.toLowerCase())) {
            fertilizerScore++;
        }
    });

    // Determine crop type
    let detectedCrop = detectCropFromQuery(lowerQuestion, lang) || crop || 'general';
    
    // Generate response based on highest scoring category
    if (diseaseScore > 0 && diseaseScore >= fertilizerScore) {
        return generateDiseaseResponse(detectedCrop, lowerQuestion, lang);
    } else if (fertilizerScore > 0) {
        return generateFertilizerResponse(detectedCrop, stage, lang);
    } else if (lowerQuestion.includes('weather') || lowerQuestion.includes('मौसम') || lowerQuestion.includes('കാലാവസ്ഥ')) {
        return generateWeatherResponse(lang);
    } else if (lowerQuestion.includes('price') || lowerQuestion.includes('market') || lowerQuestion.includes('दाम') || lowerQuestion.includes('വില')) {
        return generateMarketResponse(lang);
    } else {
        return generateGeneralResponse(detectedCrop, stage, location, lang);
    }
}

// Enhanced crop detection from query
function detectCropFromQuery(query, lang) {
    const cropMappings = {
        rice: {
            en: ['rice', 'paddy', 'grain'],
            hi: ['धान', 'चावल'],
            ml: ['നെൽ', 'അരി']
        },
        banana: {
            en: ['banana', 'plantain'],
            hi: ['केला'],
            ml: ['വാഴ', 'എത്തക്കാ']
        },
        coconut: {
            en: ['coconut', 'palm'],
            hi: ['नारियल'],
            ml: ['തെങ്ങ്', 'നാളികേരം']
        },
        pepper: {
            en: ['pepper', 'black pepper'],
            hi: ['काली मिर्च', 'मिर्च'],
            ml: ['കുരുമുളക്']
        }
    };

    for (const [crop, keywords] of Object.entries(cropMappings)) {
        if (keywords[lang] && keywords[lang].some(keyword => query.includes(keyword.toLowerCase()))) {
            return crop;
        }
    }
    return null;
}

// Generate disease-specific response
function generateDiseaseResponse(crop, query, lang) {
    const knowledge = comprehensiveAgriculturalKnowledge.cropDiseases[crop];
    if (!knowledge || !knowledge[lang]) {
        return getDefaultDiseaseResponse(lang);
    }

    // Specific disease detection
    if (query.includes('blast') || query.includes('ब्लास्ट') || query.includes('ബ്ലാസ്റ്റ്')) {
        return knowledge[lang].blast || knowledge[lang][Object.keys(knowledge[lang])[0]];
    } else if (query.includes('spot') || query.includes('धब्बा') || query.includes('പാട്')) {
        return knowledge[lang].leaf_spot || knowledge[lang].brownspot || knowledge[lang][Object.keys(knowledge[lang])[0]];
    } else if (query.includes('wilt') || query.includes('मुरझा') || query.includes('വാട്')) {
        return knowledge[lang].root_wilt || knowledge[lang].quick_wilt || knowledge[lang][Object.keys(knowledge[lang])[0]];
    } else if (query.includes('rot') || query.includes('सड़') || query.includes('ചവറ്')) {
        return knowledge[lang].bud_rot || knowledge[lang].crown_rot || knowledge[lang].root_rot || knowledge[lang][Object.keys(knowledge[lang])[0]];
    }

    // Return first available disease info
    return knowledge[lang][Object.keys(knowledge[lang])[0]];
}

// Generate fertilizer response
function generateFertilizerResponse(crop, stage, lang) {
    const knowledge = comprehensiveAgriculturalKnowledge.fertilizationGuide[crop];
    if (!knowledge || !knowledge[lang]) {
        return getDefaultFertilizerResponse(lang);
    }

    // Return detailed fertilization schedule
    if (knowledge[lang].schedule) {
        return knowledge[lang].schedule;
    } else if (knowledge[lang].monthly) {
        return knowledge[lang].monthly;
    }

    return getDefaultFertilizerResponse(lang);
}

// Generate weather response
function generateWeatherResponse(lang) {
    const currentSeason = getCurrentSeason();
    const advisory = comprehensiveAgriculturalKnowledge.weatherAdvisory[lang];
    
    if (advisory && advisory[currentSeason]) {
        return `Kerala Weather Update - ${getCurrentSeasonName(lang)} Season:\n\n${advisory[currentSeason]}\n\nCurrent Conditions: Temperature 24-32°C, Humidity 65-85%, ${getCurrentSeasonConditions(lang)}`;
    }
    
    return getDefaultWeatherResponse(lang);
}

// Helper functions for weather
function getCurrentSeason() {
    const month = new Date().getMonth() + 1;
    if (month >= 6 && month <= 9) return 'monsoon';
    if (month >= 3 && month <= 5) return 'summer';
    return 'winter';
}

function getCurrentSeasonName(lang) {
    const season = getCurrentSeason();
    const names = {
        monsoon: { en: 'Monsoon', hi: 'मानसून', ml: 'മഴക്കാലം' },
        summer: { en: 'Summer', hi: 'गर्मी', ml: 'വേനൽ' },
        winter: { en: 'Winter', hi: 'सर्दी', ml: 'ശീതകാലം' }
    };
    return names[season][lang];
}

function getCurrentSeasonConditions(lang) {
    const season = getCurrentSeason();
    const conditions = {
        monsoon: { 
            en: 'Heavy rainfall expected, maintain drainage', 
            hi: 'भारी बारिश की उम्मीद, जल निकासी बनाए रखें',
            ml: 'കനത്ത മഴ പ്രതീക്ഷിക്കുന്നു, ജലനിർഗമനം നിലനിർത്തുക'
        },
        summer: { 
            en: 'Hot and dry conditions, increase irrigation', 
            hi: 'गर्म और शुष्क स्थिति, सिंचाई बढ़ाएं',
            ml: 'ചൂടുള്ളതും വരണ്ടതുമായ അവസ്ഥ, ജലസേചനം വർദ്ധിപ്പിക്കുക'
        },
        winter: { 
            en: 'Cool and dry, ideal for most crops', 
            hi: 'ठंडा और शुष्क, अधिकांश फसलों के लिए आदर्श',
            ml: 'തണുത്തതും വരണ്ടതും, മിക്ക വിളകൾക്കും അനുയോജ്യം'
        }
    };
    return conditions[season][lang];
}

// Generate market price response
function generateMarketResponse(lang) {
    const responses = {
        en: `Kerala Agricultural Market Prices (Current Week):\n\n**Grains & Cereals:**\n• Rice (Fine): ₹40-45/kg\n• Rice (Medium): ₹35-40/kg\n• Rice (Common): ₹28-32/kg\n\n**Spices:**\n• Black Pepper: ₹480-520/kg\n• Cardamom (Small): ₹1,800-2,200/kg\n• Cardamom (Large): ₹1,400-1,600/kg\n• Ginger (Fresh): ₹120-150/kg\n• Ginger (Dry): ₹280-320/kg\n• Turmeric: ₹180-220/kg\n\n**Plantation Crops:**\n• Coconut: ₹28-35/piece\n• Copra: ₹180-200/kg\n• Rubber: ₹165-175/kg\n• Coffee (Arabica): ₹320-380/kg\n• Coffee (Robusta): ₹240-280/kg\n\n**Fruits:**\n• Banana (Nendran): ₹60-80/dozen\n• Banana (Poovan): ₹40-55/dozen\n• Mango: ₹80-120/kg\n• Pineapple: ₹35-45/kg\n\n*Prices may vary by location and quality. For exact rates, contact your local market.*`,
        
        hi: `केरल कृषि बाजार मूल्य (वर्तमान सप्ताह):\n\n**अनाज और दालें:**\n• चावल (बेहतर): ₹40-45/किग्रा\n• चावल (मध्यम): ₹35-40/किग्रा\n• चावल (साधारण): ₹28-32/किग्रा\n\n**मसाले:**\n• काली मिर्च: ₹480-520/किग्रा\n• छोटी इलायची: ₹1,800-2,200/किग्रा\n• बड़ी इलायची: ₹1,400-1,600/किग्रा\n• अदरक (ताजा): ₹120-150/किग्रा\n• अदरक (सूखा): ₹280-320/किग्रा\n• हल्दी: ₹180-220/किग्रा\n\n**बागान फसलें:**\n• नारियल: ₹28-35/पीस\n• कोपरा: ₹180-200/किग्रा\n• रबर: ₹165-175/किग्रा\n• कॉफी (अरेबिका): ₹320-380/किग्रा\n• कॉफी (रोबस्टा): ₹240-280/किग्रा\n\n*स्थान और गुणवत्ता के अनुसार दाम अलग हो सकते हैं। सटीक दरों के लिए स्थानीय बाजार से संपर्क करें।*`,
        
        ml: `കേരള കാർഷിക വിപണി വിലകൾ (ഈ ആഴ്ച):\n\n**ധാന്യങ്ങളും പയറുവർഗ്ഗങ്ങളും:**\n• അരി (നല്ലത്): ₹40-45/കിലോ\n• അരി (ഇടത്തരം): ₹35-40/കിലോ\n• അരി (സാധാരണം): ₹28-32/കിലോ\n\n**മസാലകൾ:**\n• കുരുമുളക്: ₹480-520/കിലോ\n• ഏലം (ചെറിയത്): ₹1,800-2,200/കിലോ\n• ഏലം (വലിയത്): ₹1,400-1,600/കിലോ\n• ഇഞ്ചി (പച്ച): ₹120-150/കിലോ\n• ഇഞ്ചി (ഉണക്ക്): ₹280-320/കിലോ\n• മഞ്ഞൾ: ₹180-220/കിലോ\n\n**തോട്ടവിളകൾ:**\n• തെങ്ങ്: ₹28-35/എണ്ണം\n• കോപ്ര: ₹180-200/കിലോ\n• റബ്ബർ: ₹165-175/കിലോ\n• കാപ്പി (അറബിക്ക): ₹320-380/കിലോ\n• കാപ്പി (റോബസ്റ്റ): ₹240-280/കിലോ\n\n**പഴങ്ങൾ:**\n• വാഴപ്പഴം (നേന്ദ്രൻ): ₹60-80/ഡസൻ\n• വാഴപ്പഴം (പൂവൻ): ₹40-55/ഡസൻ\n• മാങ്ങ: ₹80-120/കിലോ\n• കൈതച്ചക്ക: ₹35-45/കിലോ\n\n*സ്ഥലവും ഗുണനിലവാരവും അനുസരിച്ച് വില വ്യത്യാസപ്പെടാം. കൃത്യമായ നിരക്കുകൾക്ക് നിങ്ങളുടെ പ്രാദേശിക മാർക്കറ്റുമായി ബന്ധപ്പെടുക.*`
    };
    
    return responses[lang];
}

// Enhanced image analysis response
function generateImageAnalysisResponse(imageData, crop, lang) {
    const analysisPrompts = {
        en: {
            disease: `Advanced Image Analysis Results:\n\n**Crop Identified:** ${crop || 'General Plant'}\n**Analysis Confidence:** 85%\n\n**Observations:**\n• Visible symptoms suggest possible fungal/bacterial infection\n• Leaf discoloration patterns indicate nutrient stress\n• Growth patterns appear abnormal for this stage\n\n**Recommended Actions:**\n1. **Immediate Treatment:**\n   - Apply broad-spectrum fungicide (Mancozeb 2g/L)\n   - Improve drainage around affected plants\n   - Remove severely affected plant parts\n\n2. **Nutritional Support:**\n   - Apply balanced NPK fertilizer\n   - Foliar spray of micronutrients\n   - Ensure adequate potassium for disease resistance\n\n3. **Monitoring:**\n   - Check plants daily for symptom progression\n   - Isolate affected plants if disease spreads\n   - Consult local agricultural officer for confirmation\n\n**Prevention for Future:**\n• Maintain proper plant spacing\n• Ensure good air circulation\n• Practice crop rotation\n• Use disease-resistant varieties\n\n*Note: For precise diagnosis, please visit your nearest Krishi Bhavan with fresh plant samples.*`,
            
            healthy: `Image Analysis Results:\n\n**Crop Identified:** ${crop || 'General Plant'}\n**Plant Health Status:** Good to Excellent\n**Analysis Confidence:** 90%\n\n**Observations:**\n• Plants show healthy green coloration\n• No visible disease symptoms detected\n• Growth appears normal for the stage\n• Good leaf structure and density\n\n**Maintenance Recommendations:**\n1. Continue current care practices\n2. Monitor for seasonal pests\n3. Maintain regular fertilization schedule\n4. Ensure consistent watering\n\n**Optimization Tips:**\n• Apply organic mulch for moisture retention\n• Consider foliar feeding during active growth\n• Maintain soil pH between 6.0-7.0\n• Schedule preventive pest management\n\nKeep up the excellent work! Your plants are thriving.`,
            
            pest: `Pest Analysis Results:\n\n**Crop Identified:** ${crop || 'General Plant'}\n**Pest Type:** Likely insect damage detected\n**Severity Level:** Moderate\n\n**Damage Pattern Analysis:**\n• Chewing/sucking damage visible on leaves\n• Irregular holes and defoliation patterns\n• Signs of pest activity present\n\n**Immediate Control Measures:**\n1. **Organic Treatment:**\n   - Neem oil spray 5ml/L every 5 days\n   - Soap water solution for soft-bodied insects\n   - Introduce beneficial predators\n\n2. **Chemical Control (if severe):**\n   - Imidacloprid 17.8% SL @ 0.5ml/L\n   - Spray during evening hours\n   - Follow safety precautions\n\n3. **Cultural Practices:**\n   - Remove affected plant debris\n   - Improve field sanitation\n   - Monitor trap crops if available\n\n**Long-term Management:**\n• Implement Integrated Pest Management (IPM)\n• Use pheromone traps for monitoring\n• Maintain biodiversity in and around fields\n• Regular field scouting and early detection`
        },
        
        hi: {
            disease: `उन्नत छवि विश्लेषण परिणाम:\n\n**पहचानी गई फसल:** ${crop || 'सामान्य पौधा'}\n**विश्लेषण विश्वास:** 85%\n\n**अवलोकन:**\n• दृश्य लक्षण संभावित कवक/जीवाणु संक्रमण का सुझाव देते हैं\n• पत्ती का रंग बदलना पोषक तनाव को दर्शाता है\n• इस अवस्था के लिए विकास पैटर्न असामान्य दिखते हैं\n\n**अनुशंसित कार्य:**\n1. **तत्काल उपचार:**\n   - व्यापक स्पेक्ट्रम फफूंदनाशक (मैंकोजेब 2g/L) लगाएं\n   - प्रभावित पौधों के चारों ओर जल निकासी में सुधार करें\n   - गंभीर रूप से प्रभावित पौधे के हिस्सों को हटाएं\n\n2. **पोषण संबंधी सहायता:**\n   - संतुलित NPK उर्वरक लगाएं\n   - सूक्ष्म पोषक तत्वों का पर्णीय छिड़काव\n   - रोग प्रतिरोध के लिए पर्याप्त पोटेशियम सुनिश्चित करें\n\n*सटीक निदान के लिए कृपया ताजे पौधे के नमूनों के साथ अपने निकटतम कृषि भवन जाएं।*`,
            
            healthy: `छवि विश्लेषण परिणाम:\n\n**पहचानी गई फसल:** ${crop || 'सामान्य पौधा'}\n**पौधे की स्वास्थ्य स्थिति:** अच्छी से उत्कृष्ट\n**विश्लेषण विश्वास:** 90%\n\n**अवलोकन:**\n• पौधे स्वस्थ हरा रंग दिखाते हैं\n• कोई दृश्यमान रोग लक्षण नहीं मिले\n• विकास इस अवस्था के लिए सामान्य दिखता है\n• अच्छी पत्ती संरचना और घनत्व\n\n**रखरखाव सिफारिशें:**\n1. वर्तमान देखभाल प्रथाओं को जारी रखें\n2. मौसमी कीटों की निगरानी करें\n3. नियमित उर्वरीकरण कार्यक्रम बनाए रखें\n4. लगातार पानी देना सुनिश्चित करें\n\nबहुत अच्छा काम! आपके पौधे फल-फूल रहे हैं।`,
            
            pest: `कीट विश्लेषण परिणाम:\n\n**पहचानी गई फसल:** ${crop || 'सामान्य पौधा'}\n**कीट प्रकार:** संभावित कीट क्षति का पता चला\n**गंभीरता स्तर:** मध्यम\n\n**नुकसान पैटर्न विश्लेषण:**\n• पत्तियों पर चबाने/चूसने की क्षति दिखाई दे रही है\n• अनियमित छेद और पत्ती गिराने के पैटर्न\n• कीट गतिविधि के संकेत मौजूद\n\n**तत्काल नियंत्रण उपाय:**\n1. **जैविक उपचार:**\n   - नीम तेल स्प्रे 5ml/L हर 5 दिन में\n   - मुलायम शरीर वाले कीड़ों के लिए साबुन पानी का घोल\n   - लाभकारी शिकारी कीड़े लाएं\n\n*दीर्घकालिक प्रबंधन के लिए एकीकृत कीट प्रबंधन (IPM) लागू करें।*`
        },
        
        ml: {
            disease: `വിപുലമായ ചിത്ര വിശകലന ഫലങ്ങൾ:\n\n**തിരിച്ചറിഞ്ഞ വിള:** ${crop || 'പൊതു സസ്യം'}\n**വിശകലന വിശ്വാസ്യത:** 85%\n\n**നിരീക്ഷണങ്ങൾ:**\n• ദൃശ്യമായ ലക്ഷണങ്ങൾ സാധ്യമായ കുമിൾ/ബാക്ടീരിയ അണുബാധയെ സൂചിപ്പിക്കുന്നു\n• ഇലയുടെ നിറം മാറുന്ന പാറ്റേണുകൾ പോഷക സമ്മർദ്ദത്തെ സൂചിപ്പിക്കുന്നു\n• ഈ ഘട്ടത്തിനുള്ള വളർച്ചാ പാറ്റേണുകൾ അസാധാരണമായി കാണപ്പെടുന്നു\n\n**ശുപാർശ ചെയ്യുന്ന പ്രവർത്തനങ്ങൾ:**\n1. **ഉടനടി ചികിത്സ:**\n   - വിശാല-സ്പെക്ട്രം കുമിൾനാശിനി (മാൻകോസെബ് 2g/L) പ്രയോഗിക്കുക\n   - രോഗബാധിത ചെടികൾക്ക് ചുറ്റും ജലനിർഗമനം മെച്ചപ്പെടുത്തുക\n   - ഗുരുതരമായി ബാധിച്ച ചെടിയുടെ ഭാഗങ്ങൾ നീക്കം ചെയ്യുക\n\n2. **പോഷക പിന്തുണ:**\n   - സമതുലിതമായ NPK വളം പ്രയോഗിക്കുക\n   - സൂക്ഷ്മ പോഷകങ്ങളുടെ ഇല തളികൽ\n   - രോഗ പ്രതിരോധത്തിനായി ആവശ്യത്തിന് പൊട്ടാസ്യം ഉറപ്പാക്കുക\n\n*കൃത്യമായ രോഗനിർണയത്തിനായി പുതിയ ചെടിയുടെ സാമ്പിളുകളുമായി നിങ്ങളുടെ അടുത്തുള്ള കൃഷി ഭവൻ സന്ദർശിക്കുക.*`,
            
            healthy: `ചിത്ര വിശകലന ഫലങ്ങൾ:\n\n**തിരിച്ചറിഞ്ഞ വിള:** ${crop || 'പൊതു സസ്യം'}\n**ചെടിയുടെ ആരോഗ്യ നില:** നല്ലത് മുതൽ മികച്ചത് വരെ\n**വിശകലന വിശ്വാസ്യത:** 90%\n\n**നിരീക്ഷണങ്ങൾ:**\n• ചെടികൾ ആരോഗ്യകരമായ പച്ച നിറം കാണിക്കുന്നു\n• ദൃശ്യമായ രോഗ ലക്ഷണങ്ങൾ കണ്ടെത്തിയില്ല\n• ഈ ഘട്ടത്തിന് വളർച്ച സാധാരണമായി കാണപ്പെടുന്നു\n• നല്ല ഇല ഘടനയും സാന്ദ്രതയും\n\n**പരിപാലന ശുപാർശകൾ:**\n1. നിലവിലുള്ള പരിചരണ രീതികൾ തുടരുക\n2. സീസണൽ കീടങ്ങൾക്കായി നിരീക്ഷിക്കുക\n3. സ്ഥിരമായ വള പ്രയോഗ ഷെഡ്യൂൾ പരിപാലിക്കുക\n4. സ്ഥിരമായ നീർവിതരണം ഉറപ്പാക്കുക\n\nമികച്ച ജോലി! നിങ്ങളുടെ ചെടികൾ നന്നായി വളരുന്നു.`,
            
            pest: `കീട വിശകലന ഫലങ്ങൾ:\n\n**തിരിച്ചറിഞ്ഞ വിള:** ${crop || 'പൊതു സസ്യം'}\n**കീട തരം:** സാധ്യമായ കീട നാശം കണ്ടെത്തി\n**ഗുരുത്വാകർഷണ നില:** മിതമായത്\n\n**നാശ പാറ്റേൺ വിശകലനം:**\n• ഇലകളിൽ കടിക്കൽ/കുടിക്കൽ നാശം കാണപ്പെടുന്നു\n• ക്രമരഹിതമായ ദ്വാരങ്ങളും ഇലപൊഴിക്കൽ പാറ്റേണുകളും\n• കീട പ്രവർത്തനത്തിന്റെ ലക്ഷണങ്ങൾ നിലവിലുണ്ട്\n\n**ഉടനടി നിയന്ത്രണ നടപടികൾ:**\n1. **ജൈവ ചികിത്സ:**\n   - വേപ്പെണ്ണ സ്പ്രേ 5ml/L 5 ദിവസത്തിലൊരിക്കൽ\n   - മൃദുശരീരമുള്ള കീടങ്ങൾക്ക് സോപ്പ് വെള്ളം ലായനി\n   - പ്രയോജനകരമായ വേട്ടക്കാരെ പരിചയപ്പെടുത്തുക\n\n*ദീർഘകാല മാനേജ്മെന്റിനായി സംയോജിത കീട മാനേജ്മെന്റ് (IPM) നടപ്പിലാക്കുക.*`
        }
    };

    // Simple image analysis simulation - in real app, this would use ML models
    const analysisType = Math.random() < 0.6 ? 'disease' : Math.random() < 0.8 ? 'healthy' : 'pest';
    return analysisPrompts[lang][analysisType];
}

// Default responses for fallback scenarios
function getDefaultDiseaseResponse(lang) {
    const responses = {
        en: `Disease Management Advisory:\n\nBased on your query, here are general disease management practices:\n\n1. **Prevention:**\n• Use certified disease-free seeds/planting material\n• Maintain proper field sanitation\n• Ensure adequate spacing between plants\n• Avoid waterlogging conditions\n\n2. **Early Detection:**\n• Regular field monitoring\n• Look for yellowing, spotting, or wilting\n• Check for unusual growth patterns\n\n3. **Immediate Action:**\n• Apply broad-spectrum fungicide\n• Remove affected plant parts\n• Improve drainage if needed\n• Consult local agricultural officer\n\nFor specific diagnosis, please contact your nearest Krishi Bhavan.`,
        
        hi: `रोग प्रबंधन सलाह:\n\nआपके प्रश्न के आधार पर, यहाँ सामान्य रोग प्रबंधन प्रथाएं हैं:\n\n1. **रोकथाम:**\n• प्रमाणित रोग मुक्त बीज/रोपण सामग्री का उपयोग करें\n• उचित खेत स्वच्छता बनाए रखें\n• पौधों के बीच पर्याप्त दूरी सुनिश्चित करें\n• जलभराव की स्थिति से बचें\n\n2. **प्रारंभिक पहचान:**\n• नियमित खेत निगरानी\n• पीलेपन, धब्बे या मुरझाने की तलाश करें\n• असामान्य विकास पैटर्न की जांच करें\n\nविशिष्ट निदान के लिए कृपया अपने निकटतम कृषि भवन से संपर्क करें।`,
        
        ml: `രോഗ പരിപാലന ഉപദേശം:\n\nനിങ്ങളുടെ ചോദ്യത്തിന്റെ അടിസ്ഥാനത്തിൽ, ഇവിടെ പൊതുവായ രോഗ പരിപാലന രീതികൾ:\n\n1. **പ്രതിരോധം:**\n• സാക്ഷ്യപത്രമുള്ള രോഗരഹിത വിത്തുകൾ/നടീൽ സാമഗ്രികൾ ഉപയോഗിക്കുക\n• ശരിയായ വയൽ ശുചിത്വം പരിപാലിക്കുക\n• ചെടികൾക്കിടയിൽ പര്യാപ്തമായ അകലം ഉറപ്പാക്കുക\n• വെള്ളക്കെട്ട് അവസ്ഥകൾ ഒഴിവാക്കുക\n\n2. **നേരത്തെയുള്ള കണ്ടെത്തൽ:**\n• പതിവ് വയൽ നിരീക്ഷണം\n• മഞ്ഞനിറം, പാടുകൾ, വാടൽ എന്നിവയ്ക്കായി നോക്കുക\n• അസാധാരണ വളർച്ചാ പാറ്റേണുകൾ പരിശോധിക്കുക\n\nനിർദ്ദിഷ്ട രോഗനിർണയത്തിനായി നിങ്ങളുടെ അടുത്തുള്ള കൃഷി ഭവനുമായി ബന്ധപ്പെടുക.`
    };
    return responses[lang];
}

function getDefaultFertilizerResponse(lang) {
    const responses = {
        en: `General Fertilization Guidelines:\n\n**Soil Testing First:**\n• Get soil tested every 2-3 years\n• Maintain pH 6.0-7.0 for most crops\n• Check for major and micronutrient status\n\n**Basic NPK Application:**\n• Nitrogen: Apply in split doses during growing season\n• Phosphorus: Apply as basal dose before planting\n• Potassium: Apply half basal, half at flowering\n\n**Organic Matter:**\n• Apply 5-10 tonnes compost per hectare\n• Use green manuring when possible\n• Apply organic mulch around plants\n\n**Micronutrients:**\n• Apply zinc if deficient (common in Kerala)\n• Iron foliar spray during vegetative growth\n• Boron for flowering and fruit development\n\nFor crop-specific recommendations, consult your local Krishi Bhavan officer.`,
        
        hi: `सामान्य उर्वरीकरण दिशानिर्देश:\n\n**पहले मिट्टी परीक्षण:**\n• हर 2-3 साल में मिट्टी का परीक्षण कराएं\n• अधिकांश फसलों के लिए pH 6.0-7.0 बनाए रखें\n• मुख्य और सूक्ष्म पोषक तत्वों की स्थिति जांचें\n\n**बुनियादी NPK प्रयोग:**\n• नाइट्रोजन: बढ़ते मौसम के दौरान विभाजित खुराक में डालें\n• फास्फोरस: रोपण से पहले आधार खुराक के रूप में डालें\n• पोटेशियम: आधा आधार, आधा फूल आने पर डालें\n\nफसल-विशिष्ट सिफारिशों के लिए अपने स्थानीय कृषि भवन अधिकारी से सलाह लें।`,
        
        ml: `പൊതുവായ വളപ്രയോഗ മാർഗ്ഗനിർദ്ദേശങ്ങൾ:\n\n**ആദ്യം മണ്ണ് പരിശോധന:**\n• 2-3 വർഷത്തിലൊരിക്കൽ മണ്ണ് പരിശോധന നടത്തുക\n• മിക്ക വിളകൾക്കും pH 6.0-7.0 നിലനിർത്തുക\n• പ്രധാന, സൂക്ഷ്മ പോഷക അവസ്ഥ പരിശോധിക്കുക\n\n**അടിസ്ഥാന NPK പ്രയോഗം:**\n• നൈട്രജൻ: വളരുന്ന സീസണിൽ വിഭജിച്ച് പ്രയോഗിക്കുക\n• ഫോസ്ഫറസ്: നടുന്നതിന് മുമ്പ് അടിവളമായി പ്രയോഗിക്കുക\n• പൊട്ടാസ്യം: പകുതി അടിവളം, പകുതി പൂവിടുന്ന സമയത്ത്\n\nവിള-നിർദ്ദിഷ്ട ശുപാർശകൾക്കായി നിങ്ങളുടെ പ്രാദേശിക കൃഷി ഭവൻ ഓഫീസറുമായി കൂടിയാലോചിക്കുക.`
    };
    return responses[lang];
}

function getDefaultWeatherResponse(lang) {
    const responses = {
        en: "Current Kerala Weather: Temperature 24-32°C, Humidity 65-85%. For updated weather forecasts and agricultural advisories, please check local meteorological department or visit your nearest Krishi Bhavan.",
        hi: "वर्तमान केरल मौसम: तापमान 24-32°C, आर्द्रता 65-85%। अपडेटेड मौसम पूर्वानुमान और कृषि सलाह के लिए स्थानीय मौसम विभाग की जांच करें।",
        ml: "കേരളത്തിലെ നിലവിലെ കാലാവസ്ഥ: താപനില 24-32°C, ആർദ്രത 65-85%. അപ്ഡേറ്റ് ചെയ്ത കാലാവസ്ഥാ പ്രവചനങ്ങൾക്കും കാർഷിക ഉപദേശങ്ങൾക്കും പ്രാദേശിക കാലാവസ്ഥാ വകുപ്പ് പരിശോധിക്കുക."
    };
    return responses[lang];
}

function generateGeneralResponse(crop, stage, location, lang) {
    const responses = {
        en: `Thank you for your agricultural inquiry about ${crop || 'farming'}${stage ? ` during ${stage} stage` : ''}${location ? ` in ${location}` : ' in Kerala'}.\n\nFor personalized field-specific guidance, I recommend:\n\n1. **Visit your local Krishi Bhavan** for expert consultation\n2. **Contact agricultural helpline** at 1800-180-1551\n3. **Consult extension officers** in your area\n4. **Join farmer groups** for peer learning\n\n**General Best Practices:**\n• Regular soil testing and nutrient management\n• Integrated pest and disease management\n• Water conservation techniques\n• Use of quality seeds and planting materials\n• Proper post-harvest handling\n\n**Government Support:**\nExplore various schemes like PM Kisan Samman Nidhi, Kisan Credit Card, and crop insurance programs available through your local Krishi Bhavan.\n\nFor immediate assistance with specific problems, please provide more details about your concern.`,
        
        hi: `${crop || 'खेती'} के बारे में आपकी कृषि पूछताछ के लिए धन्यवाद${stage ? ` ${stage} अवस्था के दौरान` : ''}${location ? ` ${location} में` : ' केरल में'}।\n\nव्यक्तिगत क्षेत्र-विशिष्ट मार्गदर्शन के लिए, मैं सुझाता हूं:\n\n1. **विशेषज्ञ परामर्श के लिए अपने स्थानीय कृषि भवन जाएं**\n2. **कृषि हेल्पलाइन से संपर्क करें** 1800-180-1551 पर\n3. **अपने क्षेत्र के विस्तार अधिकारियों से सलाह लें**\n4. **साथी सीखने के लिए किसान समूहों में शामिल हों**\n\n**सामान्य सर्वोत्तम प्रथाएं:**\n• नियमित मिट्टी परीक्षण और पोषक प्रबंधन\n• एकीकृत कीट और रोग प्रबंधन\n• जल संरक्षण तकनीकें\n• गुणवत्तापूर्ण बीज और रोपण सामग्री का उपयोग\n• उचित फसल के बाद की हैंडलिंग\n\nविशिष्ट समस्याओं के साथ तत्काल सहायता के लिए, कृपया अपनी चिंता के बारे में अधिक विवरण प्रदान करें।`,
        
        ml: `${crop || 'കൃഷി'}യെക്കുറിച്ചുള്ള നിങ്ങളുടെ കാർഷിക അന്വേഷണത്തിന് നന്ദി${stage ? ` ${stage} ഘട്ടത്തിൽ` : ''}${location ? ` ${location}യിൽ` : ' കേരളത്തിൽ'}।\n\nവ്യക്തിഗത ഫീൽഡ് നിർദ്ദിഷ്ട മാർഗ്ഗദർശനത്തിനായി, ഞാൻ ശുപാർശ ചെയ്യുന്നു:\n\n1. **വിദഗ്ധ കൺസൾട്ടേഷനായി നിങ്ങളുടെ പ്രാദേശിക കൃഷി ഭവൻ സന്ദർശിക്കുക**\n2. **കാർഷിക ഹെൽപ്പ്ലൈൻ ബന്ധപ്പെടുക** 1800-180-1551\n3. **നിങ്ങളുടെ പ്രദേശത്തെ വിപുലീകരണ ഓഫീസർമാരുമായി കൂടിയാലോചിക്കുക**\n4. **സഹ പഠനത്തിനായി കർഷക ഗ്രൂപ്പുകളിൽ ചേരുക**\n\n**പൊതുവായ മികച്ച രീതികൾ:**\n• പതിവ് മണ്ണ് പരിശോധനയും പോഷക പരിപാലനവും\n• സംയോജിത കീട, രോഗ പരിപാലനം\n• ജല സംരക്ഷണ സാങ്കേതിക വിദ്യകൾ\n• ഗുണനിലവാരമുള്ള വിത്തുകളുടെയും നടീൽ സാമഗ്രികളുടെയും ഉപയോഗം\n• ശരിയായ വിളവെടുപ്പിനു ശേഷമുള്ള കൈകാര്യം\n\nനിർദ്ദിഷ്ട പ്രശ്നങ്ങൾക്ക് ഉടനടി സഹായത്തിനായി, നിങ്ങളുടെ ആശങ്കയെക്കുറിച്ച് കൂടുതൽ വിശദാంശങ്ങൾ നൽകുക.`
    };
    
    return responses[lang];
}

// ENHANCED Submit Question Function - REPLACE the existing one
function submitQuestion() {
    const activeMethod = document.querySelector('.method-tab.active').getAttribute('data-method');
    const crop = document.getElementById('cropSelect').value;
    const stage = document.getElementById('stageSelect').value;
    const location = document.getElementById('locationSelect').value;
    
    let questionContent = '';
    let hasContent = false;
    let imageData = null;

    // Validate input based on method
    switch (activeMethod) {
        case 'text':
            questionContent = document.getElementById('questionText').value.trim();
            hasContent = questionContent.length > 0;
            break;
        case 'voice':
            hasContent = recordedChunks.length > 0;
            questionContent = 'Voice recording submitted for agricultural analysis';
            break;
        case 'image':
            const imagePreview = document.getElementById('imagePreview');
            hasContent = imagePreview && !imagePreview.classList.contains('hidden');
            questionContent = 'Image submitted for crop analysis';
            imageData = 'crop_image_data'; // Simulated image data
            break;
    }

    // Validate required fields
    if (!hasContent) {
        showNotification(
            currentLanguage === 'en' ? 'Please provide your question using the selected method.' :
            currentLanguage === 'hi' ? 'कृपया चयनित विधि का उपयोग करके अपना प्रश्न प्रदान करें।' :
            'ദയവായി തിരഞ്ഞെടുത്ത രീതി ഉപയോഗിച്ച് നിങ്ങളുടെ ചോദ്യം നൽകുക.',
            'warning'
        );
        return;
    }

    // Show processing message
    showNotification(
        currentLanguage === 'en' ? 'AI is analyzing your question...' :
        currentLanguage === 'hi' ? 'AI आपके प्रश्न का विश्लेषण कर रहा है...' :
        'AI നിങ്ങളുടെ ചോദ്യം വിശകലനം ചെയ്യുന്നു...',
        'info'
    );
    
    // Create AI response container
    const responseContainer = createResponseContainer();
    
    // Generate Advanced AI response with delay to simulate processing
    setTimeout(() => {
        const aiResponse = generateAdvancedAIResponse(questionContent, crop, stage, location, imageData);
        
        displayAIResponse(responseContainer, aiResponse, questionContent, {
            method: activeMethod,
            crop: crop,
            stage: stage,
            location: location
        });
        
        // Clear form after successful submission
        clearQuestionForm();
        
    }, Math.random() * 2000 + 1500); // Random delay between 1.5-3.5 seconds
}

// Enhanced response display with better formatting
function displayAIResponse(container, response, question, metadata) {
    const responseHTML = `
        <div class="ai-response-header" style="margin-bottom: 20px; border-bottom: 2px solid #28a745; padding-bottom: 15px;">
            <h3 style="color: #28a745; margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-robot" style="font-size: 1.5rem;"></i> 
                ${currentLanguage === 'en' ? 'Advanced AI Agricultural Advisor' : 
                  currentLanguage === 'hi' ? 'उन्नत AI कृषि सलाहकार' : 
                  'അഡ്വാൻസ്ഡ് AI കാർഷിക ഉപദേശകൻ'}
            </h3>
            <div style="font-size: 0.95rem; color: #6c757d; margin-top: 8px; display: flex; align-items: center; gap: 15px;">
                <span><i class="fas fa-language"></i> ${currentLanguage === 'en' ? 'English' : currentLanguage === 'hi' ? 'हिन्दी' : 'മലയാളം'}</span>
                <span><i class="fas fa-clock"></i> ${new Date().toLocaleString()}</span>
                <span><i class="fas fa-check-circle" style="color: #28a745;"></i> ${currentLanguage === 'en' ? 'Analysis Complete' : currentLanguage === 'hi' ? 'विश्लेषण पूर्ण' : 'വിശകലനം പൂർത്തിയായി'}</span>
            </div>
        </div>
        
        <div class="question-summary" style="background: linear-gradient(135deg, #e9f5ff 0%, #e3f2fd 100%); padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                <i class="fas fa-question-circle" style="color: #2196f3;"></i>
                <strong style="color: #1565c0;">${currentLanguage === 'en' ? 'Your Query:' : currentLanguage === 'hi' ? 'आपका प्रश्न:' : 'നിങ്ങളുടെ ചോദ്യം:'}</strong>
            </div>
            <div style="font-style: italic; color: #424242; line-height: 1.5;">"${question}"</div>
            ${metadata.crop || metadata.stage || metadata.location ? `
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #bbdefb; font-size: 0.9rem; color: #1976d2;">
                    ${metadata.crop ? `<span style="background: #e3f2fd; padding: 4px 8px; border-radius: 4px; margin-right: 8px;"><i class="fas fa-seedling"></i> <strong>${currentLanguage === 'en' ? 'Crop:' : currentLanguage === 'hi' ? 'फसल:' : 'വിള:'}</strong> ${metadata.crop}</span>` : ''}
                    ${metadata.stage ? `<span style="background: #e3f2fd; padding: 4px 8px; border-radius: 4px; margin-right: 8px;"><i class="fas fa-chart-line"></i> <strong>${currentLanguage === 'en' ? 'Stage:' : currentLanguage === 'hi' ? 'चरण:' : 'ഘട്ടം:'}</strong> ${metadata.stage}</span>` : ''}
                    ${metadata.location ? `<span style="background: #e3f2fd; padding: 4px 8px; border-radius: 4px;"><i class="fas fa-map-marker-alt"></i> <strong>${currentLanguage === 'en' ? 'Location:' : currentLanguage === 'hi' ? 'स्थान:' : 'സ്ഥലം:'}</strong> ${metadata.location}</span>` : ''}
                </div>
            ` : ''}
        </div>
        
        <div class="ai-response-content" style="line-height: 1.8; color: #333; font-size: 16px; background: #ffffff; padding: 20px; border-radius: 10px; border: 1px solid #e0e0e0; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            ${response.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>')}
        </div>
        
        <div class="response-actions" style="margin-top: 25px; padding-top: 20px; border-top: 2px solid #f0f0f0; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;">
            <button onclick="askFollowUp()" class="btn" style="background: #2196f3; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.95rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-comments"></i> 
                ${currentLanguage === 'en' ? 'Ask Follow-up' : currentLanguage === 'hi' ? 'अनुवर्ती प्रश्न' : 'തുടർ ചോദ്യം'}
            </button>
            <button onclick="contactExpert()" class="btn" style="background: #ff9800; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.95rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-user-tie"></i> 
                ${currentLanguage === 'en' ? 'Contact Expert' : currentLanguage === 'hi' ? 'विशेषज्ञ संपर्क' : 'വിദഗ്ധനെ ബന്ധപ്പെടുക'}
            </button>
            <button onclick="saveResponse()" class="btn" style="background: #4caf50; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.95rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-bookmark"></i> 
                ${currentLanguage === 'en' ? 'Save Advice' : currentLanguage === 'hi' ? 'सलाह सेव करें' : 'ഉപദേശം സംരക്ഷിക്കുക'}
            </button>
            <button onclick="shareResponse()" class="btn" style="background: #9c27b0; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 0.95rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-share-alt"></i> 
                ${currentLanguage === 'en' ? 'Share' : currentLanguage === 'hi' ? 'साझा करें' : 'പങ്കിടുക'}
            </button>
        </div>
        
        <div class="disclaimer" style="margin-top: 20px; padding: 15px; background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 8px; font-size: 0.9rem; color: #e65100;">
            <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
            <strong>${currentLanguage === 'en' ? 'Disclaimer:' : currentLanguage === 'hi' ? 'अस्वीकरण:' : 'നിരാകരണം:'}</strong> 
            ${currentLanguage === 'en' ? 'This AI-generated advice is for general guidance. For precise diagnosis and treatment, please consult your local Krishi Bhavan officer or agricultural extension service.' : 
              currentLanguage === 'hi' ? 'यह AI-जनरेटेड सलाह सामान्य मार्गदर्शन के लिए है। सटीक निदान और उपचार के लिए कृपया अपने स्थानीय कृषि भवन अधिकारी या कृषि विस्तार सेवा से सलाह लें।' : 
              'ഈ AI-ജനറേറ്റഡ് ഉപദേശം പൊതുവായ മാർഗ്ഗദർശനത്തിനാണ്. കൃത്യമായ രോഗനിർണയത്തിനും ചികിത്സയ്ക്കും ദയവായി നിങ്ങളുടെ പ്രാദേശിക കൃഷി ഭവൻ ഓഫീസറോ കാർഷിക വിപുലീകരణ സേവനമോ സമ്പർക്കിക്കുക.'}
        </div>
    `;
    
    container.innerHTML = responseHTML;
    
    // Add button hover effects
    const buttons = container.querySelectorAll('.btn');
    buttons.forEach(button => {
        button.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        });
        button.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
    });
    
    // Scroll to response with smooth animation
    setTimeout(() => {
        container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
    
    // Show success notification
    showNotification(
        currentLanguage === 'en' ? 'Advanced AI analysis completed successfully!' :
        currentLanguage === 'hi' ? 'उन्नत AI विश्लेषण सफलतापूर्वक पूर्ण!' :
        'അഡ്വാൻസ്ഡ് AI വിശകലനം വിജയകരമായി പൂർത്തിയായി!',
        'success'
    );
}

// Add share response function
function shareResponse() {
    if (navigator.share) {
        const responseText = document.querySelector('#ai-response-container .ai-response-content').textContent;
        navigator.share({
            title: 'Agricultural Advice from Digital Krishi Officer',
            text: responseText.substring(0, 200) + '...',
            url: window.location.href
        });
    } else {
        // Fallback for browsers without Web Share API
        const responseText = document.querySelector('#ai-response-container .ai-response-content').textContent;
        navigator.clipboard.writeText(responseText).then(() => {
            showNotification(
                currentLanguage === 'en' ? 'Response copied to clipboard!' :
                currentLanguage === 'hi' ? 'जवाब क्लिपबोर्ड में कॉपी हो गया!' :
                'പ്രതികരണം ക്ലിപ്പ്ബോർഡിൽ പകർത്തി!',
                'success'
            );
        });
    }
}
